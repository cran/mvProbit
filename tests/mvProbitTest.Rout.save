
R version 3.2.2 (2015-08-14) -- "Fire Safety"
Copyright (C) 2015 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library( "mvProbit" )
Loading required package: mvtnorm
Loading required package: maxLik
Loading required package: miscTools

Please cite the 'maxLik' package as:
Henningsen, Arne and Toomet, Ott (2011). maxLik: A package for maximum likelihood estimation in R. Computational Statistics 26(3), 443-458. DOI 10.1007/s00180-010-0217-1.

If you have questions, suggestions, or comments regarding the 'maxLik' package, please use a forum or 'tracker' at maxLik's R-Forge site:
https://r-forge.r-project.org/projects/maxlik/
Loading required package: abind
> options( digits = 4 )
> 
> ## generate a simulated data set
> set.seed( 123 )
> # number of observations
> nObs <- 10
> 
> # generate explanatory variables
> xMat <- cbind( 
+    const = rep( 1, nObs ),
+    x1 = as.numeric( rnorm( nObs ) > 0 ),
+    x2 = as.numeric( rnorm( nObs ) > 0 ),
+    x3 = rnorm( nObs ),
+    x4 = rnorm( nObs ) )
> 
> # model coefficients
> beta <- cbind( c(  0.8,  1.2, -1.0,  1.4, -0.8 ),
+                c( -0.6,  1.0,  0.6, -1.2, -1.6 ),
+                c(  0.5, -0.6, -0.7,  1.1,  1.2 ) )
> 
> # covariance matrix of error terms
> sigma <- miscTools::symMatrix( c( 1, 0.2, 0.4, 1, -0.1, 1 ) )
> 
> # all parameters in a vector
> allCoef <- c( c( beta ), sigma[ lower.tri( sigma ) ] )
> 
> # generate dependent variables
> yMatLin <- xMat %*% beta 
> yMat <- ( yMatLin + rmvnorm( nObs, sigma = sigma, pre0.9_9994 = TRUE ) ) > 0
> colnames( yMat ) <- paste( "y", 1:3, sep = "" )
> # (yMatLin > 0 )== yMat
> 
> # unconditional expectations of dependent variables
> yExp <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ) )
> round( yExp, 3 )
      V1    V2    V3
1  0.021 0.725 0.194
2  0.394 0.768 0.214
3  0.125 0.788 0.196
4  0.235 0.681 0.292
5  0.680 0.435 0.579
6  0.028 0.973 0.034
7  0.958 0.186 0.784
8  0.856 0.247 0.724
9  0.061 0.968 0.034
10 0.998 0.067 0.923
> yExpA <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat ) )
> all.equal( yExp, yExpA )
[1] TRUE
> yExp2 <- pnorm( yMatLin )
> all.equal( yExp, as.data.frame( yExp2 ) )
[1] TRUE
> 
> 
> # conditional expectations of dependent variables
> # (assuming that all other dependent variables are one)
> yExpCond <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = GenzBretz() )
> round( yExpCond, 3 )
      V1    V2    V3
1  0.072 0.834 0.524
2  0.660 0.779 0.314
3  0.297 0.838 0.399
4  0.448 0.727 0.461
5  0.847 0.442 0.618
6  0.139 0.985 0.162
7  0.991 0.179 0.749
8  0.950 0.244 0.710
9  0.244 0.978 0.133
10 1.000 0.065 0.892
> yExpCondA <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = GenzBretz() )
> all.equal( yExpCond, yExpCondA )
[1] TRUE
> yExpCond2 <- matrix( NA, nrow = nObs, ncol = ncol( yMat ) )
> for( i in 1:nObs ) {
+    for( k in 1:ncol( yMat ) ) {
+       set.seed( 123 )
+       numerator <- pmvnorm( upper = yMatLin[ i, ], sigma = sigma )
+       set.seed( 123 )
+       denominator <- pmvnorm( upper = yMatLin[ i, -k ], sigma = sigma[ -k, -k ] )
+       yExpCond2[ i, k ] <- numerator / denominator
+    }
+ }
> all.equal( yExpCond, as.data.frame( yExpCond2 ) )
[1] TRUE
> # now with explicitly specifying the algorithm
> yExpCond3 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = GenzBretz )
> all.equal( yExpCond, yExpCond3 )
[1] TRUE
> identical( yExpCond, yExpCond3 )
[1] TRUE
> # now with integrals obtained by the Miwa algorithm
> yExpCond4 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = Miwa )
> all.equal( yExpCond, yExpCond4, tol = 1e-3 )
[1] TRUE
> # now with integrals obtained by the Miwa algorithm, less precise
> yExpCond5 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = Miwa( steps = 32 ) )
> all.equal( yExpCond4, yExpCond5, tol = 1e-3 )
[1] TRUE
> # now with integrals obtained by the TVPACK algorithm
> yExpCond6 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = TVPACK )
> all.equal( yExpCond, yExpCond6, tol = 1e-3 )
[1] TRUE
> # now with integrals obtained by the TVPACK algorithm, less precise
> yExpCond7 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = TVPACK( abseps = 0.5 ) )
> all.equal( yExpCond6, yExpCond7, tol = 1e-3 )
[1] "Component \"V1\": Mean relative difference: 0.03018"
[2] "Component \"V2\": Mean relative difference: 0.04273"
[3] "Component \"V3\": Mean relative difference: 0.04242"
> # now with integrals obtained by the GHK algorithm
> yExpCond8 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE )
> all.equal( yExpCond, yExpCond8, tol = 1e-3 )
[1] TRUE
> # now with integrals obtained by the GHK algorithm, less precise
> yExpCond9 <- mvProbitExp( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    nGHK = 100 )
> all.equal( yExpCond8, yExpCond9, tol = 1e-3 )
[1] "Component \"V1\": Mean relative difference: 0.004212"
[2] "Component \"V2\": Mean relative difference: 0.00124" 
[3] "Component \"V3\": Mean relative difference: 0.001381"
> 
> 
> # conditional expectations of dependent variables
> # (assuming that all other dependent variables are as observed)
> yExpCondObs <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ), 
+    cond = TRUE, algorithm = GenzBretz() )
> round( yExpCondObs, 3 )
      y1    y2    y3
1  0.014 0.735 0.172
2  0.364 0.744 0.119
3  0.102 0.788 0.152
4  0.197 0.813 0.461
5  0.469 0.542 0.707
6  0.025 0.973 0.029
7  0.971 0.179 0.809
8  0.890 0.244 0.783
9  0.056 0.968 0.027
10 0.999 0.065 0.926
> yExpCondObsA <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) ), 
+    cond = TRUE, algorithm = GenzBretz() )
> all.equal( yExpCondObs, yExpCondObsA )
[1] TRUE
> yExpCondObs2 <- matrix( NA, nrow = nObs, ncol = ncol( yMat ) )
> for( i in 1:nObs ){
+    for( k in 1:ncol( yMat ) ) {
+       ySign <- 2 * yMat[ i, ] - 1
+       ySign[ k ] <- 1
+       yLinTmp <- yMatLin[ i, ] * ySign
+       sigmaTmp <- diag( ySign ) %*% sigma %*% diag( ySign )
+       set.seed( 123 )
+       numerator <- pmvnorm( upper = yLinTmp, sigma = sigmaTmp )
+       set.seed( 123 )
+       denominator <- pmvnorm( upper = yLinTmp[ -k ], sigma = sigmaTmp[ -k, -k ] )
+       yExpCondObs2[ i, k ] <- numerator / denominator
+    }
+ }
> all.equal( yExpCondObs, as.data.frame( yExpCondObs2 ) )
[1] "Names: 3 string mismatches"
> # now with explicitly specifying the algorithm
> yExpCondObs3 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = GenzBretz )
> all.equal( yExpCondObs, yExpCondObs3 )
[1] TRUE
> identical( yExpCondObs, yExpCondObs3 )
[1] TRUE
> # now with integrals obtained by the Miwa algorithm
> yExpCondObs4 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = Miwa )
> all.equal( yExpCondObs, yExpCondObs4, tol = 1e-3 )
[1] TRUE
> # now with integrals obtained by the Miwa algorithm, less precise
> yExpCondObs5 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = Miwa( steps = 32 ) )
> all.equal( yExpCondObs4, yExpCondObs5, tol = 1e-3 )
[1] TRUE
> # now with integrals obtained by the TVPACK algorithm
> yExpCondObs6 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = TVPACK )
> all.equal( yExpCondObs, yExpCondObs6, tol = 1e-3 )
[1] TRUE
> # now with integrals obtained by the TVPACK algorithm, less precise
> yExpCondObs7 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = TVPACK( abseps = 0.5 ) )
> all.equal( yExpCondObs6, yExpCondObs7, tol = 1e-3 )
[1] "Component \"y1\": Mean relative difference: 0.0513" 
[2] "Component \"y2\": Mean relative difference: 0.04744"
[3] "Component \"y3\": Mean relative difference: 0.02587"
> # now with integrals obtained by the GHK algorithm
> yExpCondObs8 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE )
> all.equal( yExpCondObs, yExpCondObs8, tol = 1e-3 )
[1] TRUE
> # now with integrals obtained by the GHK algorithm, less precise
> yExpCondObs9 <- mvProbitExp( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, nGHK = 100 )
> all.equal( yExpCondObs8, yExpCondObs9, tol = 1e-3 )
[1] "Component \"y1\": Mean relative difference: 0.00177" 
[2] "Component \"y3\": Mean relative difference: 0.003009"
> 
> 
> # unconditional expectations of dependent variables by simulation
> nSim <- 10000
> ySim <- array( NA, c( nObs, ncol( yMat ), nSim ) )
> for( s in 1:nSim ) {
+    ySim[ , , s ] <- ( yMatLin + rmvnorm( nObs, sigma = sigma, pre0.9_9994 = TRUE ) ) > 0
+ }
> yExpSim <- matrix( NA, nrow = nObs, ncol = ncol( yMat ) )
> for( i in 1:nObs ) {
+    yExpSim[ i, ] <- rowSums( ySim[ i, , ] ) / nSim
+ }
> round( yExpSim, 3 )
       [,1]  [,2]  [,3]
 [1,] 0.019 0.729 0.197
 [2,] 0.400 0.760 0.215
 [3,] 0.118 0.787 0.198
 [4,] 0.237 0.684 0.299
 [5,] 0.682 0.437 0.578
 [6,] 0.028 0.971 0.036
 [7,] 0.958 0.184 0.787
 [8,] 0.855 0.255 0.716
 [9,] 0.062 0.970 0.033
[10,] 0.998 0.064 0.923
> round( yExpSim - as.matrix( yExp ), 3 )
          V1     V2     V3
 [1,] -0.002  0.004  0.003
 [2,]  0.006 -0.009  0.001
 [3,] -0.006 -0.001  0.001
 [4,]  0.003  0.004  0.007
 [5,]  0.002  0.002 -0.001
 [6,]  0.000 -0.002  0.002
 [7,]  0.000 -0.002  0.003
 [8,] -0.001  0.008 -0.008
 [9,]  0.002  0.001 -0.001
[10,]  0.001 -0.004  0.001
> 
> # for testing state of random number generator
> rnorm( 4 )
[1] -0.07305  0.71129  0.08263 -1.11817
> 
> # calculating log likelihood value(s)
> logLikVal <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = GenzBretz() )
> round( logLikVal, 3 )
 [1] -0.535 -0.942 -0.552 -2.327 -2.259 -0.086 -0.466 -0.704 -0.124 -0.149
> logLikValA <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = GenzBretz() )
> all.equal( logLikVal, logLikValA )
[1] TRUE
> # now with explicitly specifying the algorithm
> logLikVal3 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = GenzBretz )
> all.equal( logLikVal, logLikVal3 )
[1] TRUE
> identical( logLikVal, logLikVal3 )
[1] TRUE
> # now with integrals obtained by the Miwa algorithm
> logLikVal4 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = Miwa )
> all.equal( logLikVal, logLikVal4, tol = 1e-3 )
[1] TRUE
> # now with integrals obtained by the Miwa algorithm, less precise
> logLikVal5 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = Miwa( steps = 32 ) )
> all.equal( logLikVal4, logLikVal5, tol = 1e-3 )
[1] TRUE
> # now with integrals obtained by the TVPACK algorithm
> logLikVal6 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = TVPACK )
> all.equal( logLikVal, logLikVal6, tol = 1e-3 )
[1] TRUE
> # now with integrals obtained by the TVPACK algorithm, less precise
> logLikVal7 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    algorithm = TVPACK( abseps = 0.5 ) )
> all.equal( logLikVal6, logLikVal7, tol = 1e-3 )
[1] "Mean relative difference: 0.05527"
> # now with integrals obtained by the GHK algorithm
> logLikVal8 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ) )
> all.equal( logLikVal, logLikVal8, tol = 1e-3 )
[1] TRUE
> # now with integrals obtained by the GHK algorithm, less precise
> logLikVal9 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    nGHK = 100 )
> all.equal( logLikVal8, logLikVal9, tol = 1e-3 )
[1] "Mean relative difference: 0.001901"
> 
> # calculating log likelihood value(s) with one-sided gradients
> logLikValGrad1 <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    oneSidedGrad = TRUE, algorithm = GenzBretz() )
> round( c( logLikValGrad1 ), 3 )
 [1] -0.535 -0.942 -0.552 -2.327 -2.259 -0.086 -0.466 -0.704 -0.124 -0.149
> round( attr( logLikValGrad1, "gradient" ), 3 )
       b_1_0  b_1_1  b_1_2  b_1_3  b_1_4  b_2_0  b_2_1  b_2_2  b_2_3  b_2_4
 [1,] -0.039  0.000 -0.039  0.042 -0.017  0.447  0.000  0.447 -0.477  0.191
 [2,] -0.620  0.000 -0.620  0.135  0.183  0.438  0.000  0.438 -0.096 -0.129
 [3,] -0.209 -0.209 -0.209  0.214 -0.187  0.371  0.371  0.371 -0.380  0.332
 [4,]  1.494  1.494  1.494 -1.089  1.312  0.340  0.340  0.340 -0.248  0.298
 [5,]  0.917  0.917  0.000 -0.573  0.754 -0.886 -0.886  0.000  0.554 -0.728
 [6,] -0.061 -0.061 -0.061  0.103 -0.042  0.065  0.065  0.065 -0.109  0.045
 [7,]  0.071  0.071  0.071  0.060  0.039 -0.320 -0.320 -0.320 -0.268 -0.177
 [8,]  0.225  0.000  0.000  0.034 -0.014 -0.418  0.000  0.000 -0.064  0.026
 [9,] -0.122  0.000 -0.122  0.139  0.037  0.075  0.000  0.075 -0.086 -0.023
[10,]  0.005  0.000  0.000  0.006 -0.002 -0.136  0.000  0.000 -0.171  0.052
       b_3_0  b_3_1  b_3_2 b_3_3  b_3_4  R_1_2  R_1_3  R_2_3
 [1,] -0.314  0.000 -0.314 0.335 -0.134 -0.009  0.032 -0.162
 [2,] -0.241  0.000 -0.241 0.052  0.071 -0.211  0.243 -0.133
 [3,] -0.288 -0.288 -0.288 0.296 -0.258 -0.049  0.118 -0.129
 [4,] -0.791 -0.791 -0.791 0.577 -0.695  0.593 -0.947 -0.320
 [5,] -1.245 -1.245  0.000 0.778 -1.023 -0.696 -0.902  1.016
 [6,] -0.070 -0.070 -0.070 0.119 -0.048 -0.002  0.015 -0.007
 [7,]  0.344  0.344  0.344 0.288  0.190 -0.012  0.055 -0.129
 [8,]  0.391  0.000  0.000 0.060 -0.024 -0.062  0.160 -0.192
 [9,] -0.067  0.000 -0.067 0.076  0.020 -0.004  0.025 -0.008
[10,]  0.153  0.000  0.000 0.191 -0.058  0.000  0.003 -0.027
> logLikValGrad1A <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) ),
+    oneSidedGrad = TRUE, algorithm = GenzBretz() )
> all.equal( logLikValGrad1, logLikValGrad1A )
[1] TRUE
> 
> # calculating log likelihood value(s) with two-sided gradients
> logLikValGrad <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    returnGrad = TRUE, algorithm = GenzBretz() )
> round( c( logLikValGrad ), 3 )
 [1] -0.535 -0.942 -0.552 -2.327 -2.259 -0.086 -0.466 -0.704 -0.124 -0.149
> round( attr( logLikValGrad, "gradient" ), 3 )
       b_1_0  b_1_1  b_1_2  b_1_3  b_1_4  b_2_0  b_2_1  b_2_2  b_2_3  b_2_4
 [1,] -0.039  0.000 -0.039  0.042 -0.017  0.447  0.000  0.447 -0.477  0.191
 [2,] -0.620  0.000 -0.620  0.135  0.183  0.438  0.000  0.438 -0.096 -0.129
 [3,] -0.209 -0.209 -0.209  0.214 -0.187  0.371  0.371  0.371 -0.380  0.332
 [4,]  1.494  1.494  1.494 -1.089  1.312  0.340  0.340  0.340 -0.248  0.298
 [5,]  0.917  0.917  0.000 -0.573  0.754 -0.886 -0.886  0.000  0.554 -0.728
 [6,] -0.061 -0.061 -0.061  0.103 -0.042  0.065  0.065  0.065 -0.109  0.045
 [7,]  0.071  0.071  0.071  0.060  0.039 -0.320 -0.320 -0.320 -0.268 -0.177
 [8,]  0.225  0.000  0.000  0.034 -0.014 -0.418  0.000  0.000 -0.064  0.026
 [9,] -0.122  0.000 -0.122  0.139  0.037  0.075  0.000  0.075 -0.086 -0.023
[10,]  0.005  0.000  0.000  0.006 -0.002 -0.136  0.000  0.000 -0.171  0.052
       b_3_0  b_3_1  b_3_2 b_3_3  b_3_4  R_1_2  R_1_3  R_2_3
 [1,] -0.314  0.000 -0.314 0.335 -0.134 -0.009  0.032 -0.162
 [2,] -0.241  0.000 -0.241 0.052  0.071 -0.211  0.243 -0.133
 [3,] -0.288 -0.288 -0.288 0.296 -0.258 -0.049  0.118 -0.129
 [4,] -0.791 -0.791 -0.791 0.577 -0.695  0.593 -0.947 -0.320
 [5,] -1.245 -1.245  0.000 0.778 -1.023 -0.696 -0.902  1.016
 [6,] -0.070 -0.070 -0.070 0.119 -0.048 -0.002  0.015 -0.007
 [7,]  0.344  0.344  0.344 0.288  0.190 -0.012  0.055 -0.129
 [8,]  0.391  0.000  0.000 0.060 -0.024 -0.062  0.160 -0.192
 [9,] -0.067  0.000 -0.067 0.076  0.020 -0.004  0.025 -0.008
[10,]  0.153  0.000  0.000 0.191 -0.058  0.000  0.003 -0.027
> # now manually
> llTmp <- function( coef ) {
+    betaTmp <- coef[ 1:15 ]
+    sigmaTmp <- diag( 3 )
+    sigmaTmp[ lower.tri( sigmaTmp ) ] <- coef[ -(1:15) ]
+    sigmaTmp[ upper.tri( sigmaTmp ) ] <- t( sigmaTmp )[ upper.tri( sigmaTmp ) ]
+    result <- mvProbitLogLik( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+       coef = betaTmp, sigma = sigmaTmp, 
+       data = as.data.frame( cbind( xMat, yMat ) ), algorithm = GenzBretz() )
+    return( result )
+ }
> logLikValGrad2 <- numericGradient( llTmp, allCoef )
> round( logLikValGrad2, 3 )
        [,1]   [,2]   [,3]   [,4]   [,5]   [,6]   [,7]   [,8]   [,9]  [,10]
 [1,] -0.039  0.000 -0.039  0.042 -0.017  0.447  0.000  0.447 -0.477  0.191
 [2,] -0.620  0.000 -0.620  0.135  0.183  0.438  0.000  0.438 -0.096 -0.129
 [3,] -0.209 -0.209 -0.209  0.214 -0.187  0.371  0.371  0.371 -0.380  0.332
 [4,]  1.494  1.494  1.494 -1.089  1.312  0.340  0.340  0.340 -0.248  0.298
 [5,]  0.917  0.917  0.000 -0.573  0.754 -0.886 -0.886  0.000  0.554 -0.728
 [6,] -0.061 -0.061 -0.061  0.103 -0.042  0.065  0.065  0.065 -0.109  0.045
 [7,]  0.071  0.071  0.071  0.060  0.039 -0.320 -0.320 -0.320 -0.268 -0.177
 [8,]  0.225  0.000  0.000  0.034 -0.014 -0.418  0.000  0.000 -0.064  0.026
 [9,] -0.122  0.000 -0.122  0.139  0.037  0.075  0.000  0.075 -0.086 -0.023
[10,]  0.005  0.000  0.000  0.006 -0.002 -0.136  0.000  0.000 -0.171  0.052
       [,11]  [,12]  [,13] [,14]  [,15]  [,16]  [,17]  [,18]
 [1,] -0.314  0.000 -0.314 0.335 -0.134 -0.009  0.032 -0.162
 [2,] -0.241  0.000 -0.241 0.052  0.071 -0.211  0.243 -0.133
 [3,] -0.288 -0.288 -0.288 0.296 -0.258 -0.049  0.118 -0.129
 [4,] -0.791 -0.791 -0.791 0.577 -0.695  0.593 -0.947 -0.320
 [5,] -1.245 -1.245  0.000 0.778 -1.023 -0.696 -0.902  1.016
 [6,] -0.070 -0.070 -0.070 0.119 -0.048 -0.002  0.015 -0.007
 [7,]  0.344  0.344  0.344 0.288  0.190 -0.012  0.055 -0.129
 [8,]  0.391  0.000  0.000 0.060 -0.024 -0.062  0.160 -0.192
 [9,] -0.067  0.000 -0.067 0.076  0.020 -0.004  0.025 -0.008
[10,]  0.153  0.000  0.000 0.191 -0.058  0.000  0.003 -0.027
> # attr( logLikValGrad1, "gradient" ) / logLikValGrad2 - 1
> all.equal( attr( logLikValGrad1, "gradient" ), logLikValGrad2,
+   tol = 1e-5, check.attributes = FALSE )
[1] TRUE
> # attr( logLikValGrad, "gradient" ) / logLikValGrad2 - 1
> all.equal( attr( logLikValGrad, "gradient" ), logLikValGrad2,
+   check.attributes = FALSE  )
[1] TRUE
> 
> # for testing state of random number generator
> rnorm( 4 )
[1] -1.3162  0.7625  0.9036  1.6774
> 
> # calculating marginal effects, unconditional
> margEffUnc <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ) )
> round( margEffUnc, 3 )
   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.181     0.220    -0.122    -0.129     0.226    -0.241     0.070
2      0.430     0.190    -0.132    -0.374     0.215    -0.249     0.539
3      0.115     0.368    -0.203    -0.315     0.209    -0.242     0.287
4      0.208     0.383    -0.229    -0.374     0.233    -0.269     0.430
5      0.448     0.313    -0.209    -0.383     0.234    -0.271     0.501
6      0.027     0.151    -0.076    -0.153     0.066    -0.096     0.090
7      0.256     0.157    -0.133    -0.039     0.118    -0.147     0.125
8      0.132     0.377    -0.226    -0.331     0.219    -0.266     0.317
9      0.303     0.030    -0.027    -0.231     0.073    -0.097     0.168
10     0.002     0.243    -0.128    -0.029     0.118    -0.158     0.009
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.400     0.302    -0.040    -0.533     0.330
2     -0.366     0.320    -0.308    -0.488     0.349
3     -0.348     0.305    -0.164    -0.464     0.332
4     -0.429     0.378    -0.246    -0.572     0.412
5     -0.472     0.430    -0.286    -0.630     0.469
6     -0.075     0.082    -0.051    -0.101     0.090
7     -0.322     0.322    -0.071    -0.429     0.351
8     -0.379     0.368    -0.181    -0.505     0.401
9     -0.086     0.084    -0.096    -0.114     0.092
10    -0.156     0.160    -0.005    -0.209     0.174
> round( attr( margEffUnc, "vcov" )[ 1:3, , ], 2 )
, , d_y1_d_x1

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.26         0         0     -0.09         0         0      0.10
2      0.10         0         0     -0.06         0         0     -0.03
3      0.17         0         0     -0.10         0         0      0.26
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0         0     -0.06         0         0
2         0         0      0.04         0         0
3         0         0     -0.14         0         0

, , d_y2_d_x1

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0      0.18         0         0     -0.04         0         0
2         0      0.11         0         0     -0.04         0         0
3         0      0.12         0         0     -0.03         0         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.10         0         0     -0.27         0
2     -0.11         0         0     -0.15         0
3      0.00         0         0     -0.06         0

, , d_y3_d_x1

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0         0      0.08         0         0      0.00         0
2         0         0      0.06         0         0     -0.02         0
3         0         0      0.12         0         0     -0.03         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0     -0.08         0         0     -0.15
2         0     -0.07         0         0     -0.07
3         0     -0.01         0         0     -0.07

, , d_y1_d_x2

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.09         0         0      0.08         0         0     -0.04
2     -0.06         0         0      0.16         0         0      0.06
3     -0.10         0         0      0.18         0         0     -0.13
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0         0      0.03         0         0
2         0         0     -0.05         0         0
3         0         0      0.06         0         0

, , d_y2_d_x2

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0     -0.04         0         0      0.12         0         0
2         0     -0.04         0         0      0.10         0         0
3         0     -0.03         0         0      0.12         0         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.07         0         0      0.05         0
2      0.06         0         0      0.08         0
3      0.00         0         0     -0.06         0

, , d_y3_d_x2

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0         0      0.00         0         0      0.11         0
2         0         0     -0.02         0         0      0.10         0
3         0         0     -0.03         0         0      0.13         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0      0.03         0         0     -0.01
2         0      0.05         0         0      0.06
3         0     -0.01         0         0     -0.08

, , d_y1_d_x3

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.10         0         0     -0.04         0         0      0.06
2     -0.03         0         0      0.06         0         0      0.17
3      0.26         0         0     -0.13         0         0      0.44
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0         0     -0.03         0         0
2         0         0     -0.04         0         0
3         0         0     -0.20         0         0

, , d_y2_d_x3

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0     -0.10         0         0      0.07         0         0
2         0     -0.11         0         0      0.06         0         0
3         0      0.00         0         0      0.00         0         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.13         0         0      0.17         0
2      0.21         0         0      0.16         0
3      0.29         0         0      0.46         0

, , d_y3_d_x3

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0         0     -0.08         0         0      0.03         0
2         0         0     -0.07         0         0      0.05         0
3         0         0     -0.01         0         0     -0.01         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0      0.15         0         0      0.19
2         0      0.19         0         0      0.11
3         0      0.26         0         0      0.34

, , d_y1_d_x4

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1     -0.06         0         0      0.03         0         0     -0.03
2      0.04         0         0     -0.05         0         0     -0.04
3     -0.14         0         0      0.06         0         0     -0.20
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0         0      0.02         0         0
2         0         0      0.18         0         0
3         0         0      0.15         0         0

, , d_y2_d_x4

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0     -0.27         0         0      0.05         0         0
2         0     -0.15         0         0      0.08         0         0
3         0     -0.06         0         0     -0.06         0         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      0.17         0         0      0.54         0
2      0.16         0         0      0.30         0
3      0.46         0         0      0.94         0

, , d_y3_d_x4

  d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0         0     -0.15         0         0     -0.01         0
2         0         0     -0.07         0         0      0.06         0
3         0         0     -0.07         0         0     -0.08         0
  d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0      0.19         0         0      0.41
2         0      0.11         0         0      0.20
3         0      0.34         0         0      0.61

> round( drop( attr( margEffUnc, "vcov" )[ nObs, , ] ), 2 )
          d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
d_y1_d_x1         0      0.00      0.00      0.00      0.00      0.00         0
d_y2_d_x1         0      0.26      0.00      0.00      0.08      0.00         0
d_y3_d_x1         0      0.00      0.13      0.00      0.00      0.06         0
d_y1_d_x2         0      0.00      0.00      0.02      0.00      0.00         0
d_y2_d_x2         0      0.08      0.00      0.00      0.12      0.00         0
d_y3_d_x2         0      0.00      0.06      0.00      0.00      0.17         0
d_y1_d_x3         0      0.00      0.00      0.00      0.00      0.00         0
d_y2_d_x3         0     -0.11      0.00      0.00     -0.06      0.00         0
d_y3_d_x3         0      0.00     -0.06      0.00      0.00     -0.07         0
d_y1_d_x4         0      0.00      0.00      0.00      0.00      0.00         0
d_y2_d_x4         0     -0.20      0.00      0.00     -0.12      0.00         0
d_y3_d_x4         0      0.00     -0.10      0.00      0.00     -0.12         0
          d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
d_y1_d_x1      0.00      0.00         0      0.00      0.00
d_y2_d_x1     -0.11      0.00         0     -0.20      0.00
d_y3_d_x1      0.00     -0.06         0      0.00     -0.10
d_y1_d_x2      0.00      0.00         0      0.00      0.00
d_y2_d_x2     -0.06      0.00         0     -0.12      0.00
d_y3_d_x2      0.00     -0.07         0      0.00     -0.12
d_y1_d_x3      0.00      0.00         0      0.00      0.00
d_y2_d_x3      0.09      0.00         0      0.16      0.00
d_y3_d_x3      0.00      0.08         0      0.00      0.12
d_y1_d_x4      0.00      0.00         0      0.00      0.00
d_y2_d_x4      0.16      0.00         0      0.31      0.00
d_y3_d_x4      0.00      0.12         0      0.00      0.21
> print( summary( margEffUnc ), digits = c( 3, 3, 2, 2, 2 ) )
              Estimate Std. error z value Pr(> z)  
1: d_y1_d_x1     0.181      0.510    0.36    0.72  
1: d_y2_d_x1     0.220      0.420    0.52    0.60  
1: d_y3_d_x1    -0.122      0.290   -0.43    0.67  
1: d_y1_d_x2    -0.129      0.280   -0.46    0.65  
1: d_y2_d_x2     0.226      0.350    0.65    0.52  
1: d_y3_d_x2    -0.241      0.330   -0.73    0.46  
1: d_y1_d_x3     0.070      0.230    0.30    0.76  
1: d_y2_d_x3    -0.400      0.360   -1.10    0.27  
1: d_y3_d_x3     0.302      0.390    0.78    0.43  
1: d_y1_d_x4    -0.040      0.150   -0.28    0.78  
1: d_y2_d_x4    -0.533      0.740   -0.73    0.47  
1: d_y3_d_x4     0.330      0.640    0.51    0.61  
2: d_y1_d_x1     0.430      0.320    1.35    0.18  
2: d_y2_d_x1     0.190      0.330    0.58    0.56  
2: d_y3_d_x1    -0.132      0.250   -0.52    0.60  
2: d_y1_d_x2    -0.374      0.390   -0.95    0.34  
2: d_y2_d_x2     0.215      0.320    0.67    0.50  
2: d_y3_d_x2    -0.249      0.310   -0.80    0.43  
2: d_y1_d_x3     0.539      0.410    1.31    0.19  
2: d_y2_d_x3    -0.366      0.460   -0.80    0.43  
2: d_y3_d_x3     0.320      0.440    0.73    0.46  
2: d_y1_d_x4    -0.308      0.430   -0.72    0.47  
2: d_y2_d_x4    -0.488      0.550   -0.89    0.37  
2: d_y3_d_x4     0.349      0.450    0.78    0.44  
3: d_y1_d_x1     0.115      0.410    0.28    0.78  
3: d_y2_d_x1     0.368      0.350    1.05    0.30  
3: d_y3_d_x1    -0.203      0.350   -0.58    0.56  
3: d_y1_d_x2    -0.315      0.420   -0.74    0.46  
3: d_y2_d_x2     0.209      0.350    0.59    0.55  
3: d_y3_d_x2    -0.242      0.360   -0.67    0.50  
3: d_y1_d_x3     0.287      0.660    0.44    0.66  
3: d_y2_d_x3    -0.348      0.540   -0.64    0.52  
3: d_y3_d_x3     0.305      0.510    0.60    0.55  
3: d_y1_d_x4    -0.164      0.380   -0.43    0.67  
3: d_y2_d_x4    -0.464      0.970   -0.48    0.63  
3: d_y3_d_x4     0.332      0.780    0.43    0.67  
4: d_y1_d_x1     0.208      0.540    0.38    0.70  
4: d_y2_d_x1     0.383      0.360    1.07    0.28  
4: d_y3_d_x1    -0.229      0.360   -0.64    0.52  
4: d_y1_d_x2    -0.374      0.340   -1.11    0.27  
4: d_y2_d_x2     0.233      0.360    0.64    0.52  
4: d_y3_d_x2    -0.269      0.360   -0.76    0.45  
4: d_y1_d_x3     0.430      0.610    0.71    0.48  
4: d_y2_d_x3    -0.429      0.440   -0.97    0.33  
4: d_y3_d_x3     0.378      0.450    0.85    0.40  
4: d_y1_d_x4    -0.246      0.370   -0.67    0.50  
4: d_y2_d_x4    -0.572      0.780   -0.73    0.46  
4: d_y3_d_x4     0.412      0.690    0.60    0.55  
5: d_y1_d_x1     0.448      0.370    1.23    0.22  
5: d_y2_d_x1     0.313      0.480    0.65    0.51  
5: d_y3_d_x1    -0.209      0.420   -0.50    0.62  
5: d_y1_d_x2    -0.383      0.350   -1.10    0.27  
5: d_y2_d_x2     0.234      0.370    0.64    0.52  
5: d_y3_d_x2    -0.271      0.360   -0.76    0.45  
5: d_y1_d_x3     0.501      0.630    0.79    0.43  
5: d_y2_d_x3    -0.472      0.460   -1.03    0.30  
5: d_y3_d_x3     0.430      0.470    0.92    0.36  
5: d_y1_d_x4    -0.286      0.510   -0.56    0.58  
5: d_y2_d_x4    -0.630      0.350   -1.81    0.07 .
5: d_y3_d_x4     0.469      0.350    1.36    0.18  
6: d_y1_d_x1     0.027      0.150    0.17    0.86  
6: d_y2_d_x1     0.151      0.460    0.33    0.74  
6: d_y3_d_x1    -0.076      0.270   -0.28    0.78  
6: d_y1_d_x2    -0.153      0.460   -0.33    0.74  
6: d_y2_d_x2     0.066      0.250    0.27    0.79  
6: d_y3_d_x2    -0.096      0.320   -0.30    0.77  
6: d_y1_d_x3     0.090      0.390    0.23    0.82  
6: d_y2_d_x3    -0.075      0.330   -0.23    0.82  
6: d_y3_d_x3     0.082      0.330    0.25    0.80  
6: d_y1_d_x4    -0.051      0.240   -0.22    0.83  
6: d_y2_d_x4    -0.101      0.510   -0.20    0.84  
6: d_y3_d_x4     0.090      0.440    0.20    0.84  
7: d_y1_d_x1     0.256      0.460    0.56    0.57  
7: d_y2_d_x1     0.157      0.440    0.36    0.72  
7: d_y3_d_x1    -0.133      0.380   -0.35    0.73  
7: d_y1_d_x2    -0.039      0.160   -0.23    0.81  
7: d_y2_d_x2     0.118      0.360    0.33    0.74  
7: d_y3_d_x2    -0.147      0.400   -0.36    0.72  
7: d_y1_d_x3     0.125      0.400    0.31    0.76  
7: d_y2_d_x3    -0.322      0.520   -0.62    0.54  
7: d_y3_d_x3     0.322      0.470    0.69    0.49  
7: d_y1_d_x4    -0.071      0.290   -0.25    0.80  
7: d_y2_d_x4    -0.429      0.740   -0.58    0.56  
7: d_y3_d_x4     0.351      0.550    0.64    0.52  
8: d_y1_d_x1     0.132      0.200    0.66    0.51  
8: d_y2_d_x1     0.377      0.390    0.98    0.33  
8: d_y3_d_x1    -0.226      0.400   -0.56    0.58  
8: d_y1_d_x2    -0.331      0.430   -0.76    0.45  
8: d_y2_d_x2     0.219      0.410    0.54    0.59  
8: d_y3_d_x2    -0.266      0.400   -0.66    0.51  
8: d_y1_d_x3     0.317      0.380    0.83    0.40  
8: d_y2_d_x3    -0.379      0.380   -1.00    0.32  
8: d_y3_d_x3     0.368      0.370    0.99    0.32  
8: d_y1_d_x4    -0.181      0.290   -0.62    0.53  
8: d_y2_d_x4    -0.505      0.490   -1.04    0.30  
8: d_y3_d_x4     0.401      0.420    0.95    0.34  
9: d_y1_d_x1     0.303      0.600    0.50    0.61  
9: d_y2_d_x1     0.030      0.120    0.25    0.80  
9: d_y3_d_x1    -0.027      0.100   -0.26    0.80  
9: d_y1_d_x2    -0.231      0.360   -0.63    0.53  
9: d_y2_d_x2     0.073      0.180    0.40    0.69  
9: d_y3_d_x2    -0.097      0.230   -0.43    0.67  
9: d_y1_d_x3     0.168      0.420    0.40    0.69  
9: d_y2_d_x3    -0.086      0.250   -0.34    0.74  
9: d_y3_d_x3     0.084      0.240    0.35    0.73  
9: d_y1_d_x4    -0.096      0.320   -0.30    0.76  
9: d_y2_d_x4    -0.114      0.380   -0.30    0.77  
9: d_y3_d_x4     0.092      0.300    0.30    0.76  
10: d_y1_d_x1    0.002      0.010    0.19    0.85  
10: d_y2_d_x1    0.243      0.510    0.48    0.63  
10: d_y3_d_x1   -0.128      0.370   -0.35    0.73  
10: d_y1_d_x2   -0.029      0.130   -0.23    0.82  
10: d_y2_d_x2    0.118      0.350    0.34    0.74  
10: d_y3_d_x2   -0.158      0.410   -0.39    0.70  
10: d_y1_d_x3    0.009      0.040    0.24    0.81  
10: d_y2_d_x3   -0.156      0.300   -0.52    0.60  
10: d_y3_d_x3    0.160      0.280    0.57    0.57  
10: d_y1_d_x4   -0.005      0.020   -0.22    0.83  
10: d_y2_d_x4   -0.209      0.560   -0.37    0.71  
10: d_y3_d_x4    0.174      0.460    0.38    0.71  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
> margEffUncA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat ), vcov = diag( 18 ) )
> all.equal( margEffUnc, margEffUncA )
[1] TRUE
> # now with explicitly specifying dummy variables
> margEffUncD <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ),
+    dummyVar = c( "x1", "x2" ) )
> all.equal( margEffUncD, margEffUnc )
[1] TRUE
> # now with seemingly no dummy variables
> margEffUncD0 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ),
+    dummyVar = NULL )
> print( summary( margEffUncD0 ), digits = c( 3, 3, 2, 2, 2 ) )
              Estimate Std. error z value Pr(> z)  
1: d_y1_d_x1     0.060      0.230    0.26    0.79  
1: d_y2_d_x1     0.333      0.490    0.68    0.50  
1: d_y3_d_x1    -0.165      0.380   -0.44    0.66  
1: d_y1_d_x2    -0.050      0.160   -0.31    0.76  
1: d_y2_d_x2     0.200      0.280    0.71    0.48  
1: d_y3_d_x2    -0.192      0.280   -0.70    0.48  
1: d_y1_d_x3     0.070      0.230    0.30    0.76  
1: d_y2_d_x3    -0.400      0.360   -1.10    0.27  
1: d_y3_d_x3     0.302      0.390    0.78    0.43  
1: d_y1_d_x4    -0.040      0.150   -0.28    0.78  
1: d_y2_d_x4    -0.533      0.740   -0.73    0.47  
1: d_y3_d_x4     0.330      0.640    0.51    0.61  
2: d_y1_d_x1     0.462      0.430    1.09    0.28  
2: d_y2_d_x1     0.305      0.450    0.68    0.50  
2: d_y3_d_x1    -0.175      0.350   -0.49    0.62  
2: d_y1_d_x2    -0.385      0.300   -1.27    0.20  
2: d_y2_d_x2     0.183      0.220    0.82    0.41  
2: d_y3_d_x2    -0.204      0.220   -0.95    0.34  
2: d_y1_d_x3     0.539      0.410    1.31    0.19  
2: d_y2_d_x3    -0.366      0.460   -0.80    0.43  
2: d_y3_d_x3     0.320      0.440    0.73    0.46  
2: d_y1_d_x4    -0.308      0.430   -0.72    0.47  
2: d_y2_d_x4    -0.488      0.550   -0.89    0.37  
2: d_y3_d_x4     0.349      0.450    0.78    0.44  
3: d_y1_d_x1     0.246      0.740    0.33    0.74  
3: d_y2_d_x1     0.290      0.460    0.63    0.53  
3: d_y3_d_x1    -0.166      0.310   -0.54    0.59  
3: d_y1_d_x2    -0.205      0.470   -0.44    0.66  
3: d_y2_d_x2     0.174      0.310    0.56    0.58  
3: d_y3_d_x2    -0.194      0.340   -0.56    0.57  
3: d_y1_d_x3     0.287      0.660    0.44    0.66  
3: d_y2_d_x3    -0.348      0.540   -0.64    0.52  
3: d_y3_d_x3     0.305      0.510    0.60    0.55  
3: d_y1_d_x4    -0.164      0.380   -0.43    0.67  
3: d_y2_d_x4    -0.464      0.970   -0.48    0.63  
3: d_y3_d_x4     0.332      0.780    0.43    0.67  
4: d_y1_d_x1     0.369      0.750    0.49    0.62  
4: d_y2_d_x1     0.357      0.360    1.00    0.32  
4: d_y3_d_x1    -0.206      0.310   -0.67    0.50  
4: d_y1_d_x2    -0.307      0.410   -0.74    0.46  
4: d_y2_d_x2     0.214      0.320    0.68    0.50  
4: d_y3_d_x2    -0.240      0.320   -0.75    0.45  
4: d_y1_d_x3     0.430      0.610    0.71    0.48  
4: d_y2_d_x3    -0.429      0.440   -0.97    0.33  
4: d_y3_d_x3     0.378      0.450    0.85    0.40  
4: d_y1_d_x4    -0.246      0.370   -0.67    0.50  
4: d_y2_d_x4    -0.572      0.780   -0.73    0.46  
4: d_y3_d_x4     0.412      0.690    0.60    0.55  
5: d_y1_d_x1     0.429      0.330    1.31    0.19  
5: d_y2_d_x1     0.394      0.470    0.84    0.40  
5: d_y3_d_x1    -0.235      0.440   -0.53    0.60  
5: d_y1_d_x2    -0.358      0.460   -0.77    0.44  
5: d_y2_d_x2     0.236      0.400    0.59    0.55  
5: d_y3_d_x2    -0.274      0.400   -0.68    0.50  
5: d_y1_d_x3     0.501      0.630    0.79    0.43  
5: d_y2_d_x3    -0.472      0.460   -1.03    0.30  
5: d_y3_d_x3     0.430      0.470    0.92    0.36  
5: d_y1_d_x4    -0.286      0.510   -0.56    0.58  
5: d_y2_d_x4    -0.630      0.350   -1.81    0.07 .
5: d_y3_d_x4     0.469      0.350    1.36    0.18  
6: d_y1_d_x1     0.077      0.400    0.19    0.85  
6: d_y2_d_x1     0.063      0.280    0.22    0.83  
6: d_y3_d_x1    -0.045      0.190   -0.24    0.81  
6: d_y1_d_x2    -0.064      0.290   -0.22    0.82  
6: d_y2_d_x2     0.038      0.170    0.23    0.82  
6: d_y3_d_x2    -0.052      0.220   -0.24    0.81  
6: d_y1_d_x3     0.090      0.390    0.23    0.82  
6: d_y2_d_x3    -0.075      0.330   -0.23    0.82  
6: d_y3_d_x3     0.082      0.330    0.25    0.80  
6: d_y1_d_x4    -0.051      0.240   -0.22    0.83  
6: d_y2_d_x4    -0.101      0.510   -0.20    0.84  
6: d_y3_d_x4     0.090      0.440    0.20    0.84  
7: d_y1_d_x1     0.107      0.340    0.32    0.75  
7: d_y2_d_x1     0.268      0.650    0.41    0.68  
7: d_y3_d_x1    -0.176      0.490   -0.36    0.72  
7: d_y1_d_x2    -0.089      0.360   -0.25    0.81  
7: d_y2_d_x2     0.161      0.480    0.33    0.74  
7: d_y3_d_x2    -0.205      0.530   -0.38    0.70  
7: d_y1_d_x3     0.125      0.400    0.31    0.76  
7: d_y2_d_x3    -0.322      0.520   -0.62    0.54  
7: d_y3_d_x3     0.322      0.470    0.69    0.49  
7: d_y1_d_x4    -0.071      0.290   -0.25    0.80  
7: d_y2_d_x4    -0.429      0.740   -0.58    0.56  
7: d_y3_d_x4     0.351      0.550    0.64    0.52  
8: d_y1_d_x1     0.272      0.370    0.73    0.46  
8: d_y2_d_x1     0.316      0.380    0.82    0.41  
8: d_y3_d_x1    -0.201      0.360   -0.56    0.57  
8: d_y1_d_x2    -0.226      0.330   -0.68    0.50  
8: d_y2_d_x2     0.189      0.340    0.55    0.58  
8: d_y3_d_x2    -0.234      0.360   -0.64    0.52  
8: d_y1_d_x3     0.317      0.380    0.83    0.40  
8: d_y2_d_x3    -0.379      0.380   -1.00    0.32  
8: d_y3_d_x3     0.368      0.370    0.99    0.32  
8: d_y1_d_x4    -0.181      0.290   -0.62    0.53  
8: d_y2_d_x4    -0.505      0.490   -1.04    0.30  
8: d_y3_d_x4     0.401      0.420    0.95    0.34  
9: d_y1_d_x1     0.144      0.430    0.34    0.74  
9: d_y2_d_x1     0.071      0.250    0.28    0.78  
9: d_y3_d_x1    -0.046      0.170   -0.27    0.79  
9: d_y1_d_x2    -0.120      0.300   -0.41    0.68  
9: d_y2_d_x2     0.043      0.120    0.35    0.73  
9: d_y3_d_x2    -0.053      0.150   -0.35    0.72  
9: d_y1_d_x3     0.168      0.420    0.40    0.69  
9: d_y2_d_x3    -0.086      0.250   -0.34    0.74  
9: d_y3_d_x3     0.084      0.240    0.35    0.73  
9: d_y1_d_x4    -0.096      0.320   -0.30    0.76  
9: d_y2_d_x4    -0.114      0.380   -0.30    0.77  
9: d_y3_d_x4     0.092      0.300    0.30    0.76  
10: d_y1_d_x1    0.008      0.040    0.21    0.83  
10: d_y2_d_x1    0.130      0.350    0.38    0.71  
10: d_y3_d_x1   -0.087      0.250   -0.35    0.73  
10: d_y1_d_x2   -0.007      0.030   -0.21    0.84  
10: d_y2_d_x2    0.078      0.230    0.34    0.74  
10: d_y3_d_x2   -0.102      0.280   -0.36    0.72  
10: d_y1_d_x3    0.009      0.040    0.24    0.81  
10: d_y2_d_x3   -0.156      0.300   -0.52    0.60  
10: d_y3_d_x3    0.160      0.280    0.57    0.57  
10: d_y1_d_x4   -0.005      0.020   -0.22    0.83  
10: d_y2_d_x4   -0.209      0.560   -0.37    0.71  
10: d_y3_d_x4    0.174      0.460    0.38    0.71  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
> # now with seemingly only dummy variables
> margEffUncDA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ),
+    dummyVar = c( "x1", "x2", "x3", "x4" ) )
> print( summary( margEffUncDA ), digits = c( 3, 3, 2, 2, 2 ) )
              Estimate Std. error z value Pr(> z)  
1: d_y1_d_x1     0.181      0.510    0.36    0.72  
1: d_y2_d_x1     0.220      0.420    0.52    0.60  
1: d_y3_d_x1    -0.122      0.290   -0.43    0.67  
1: d_y1_d_x2    -0.129      0.280   -0.46    0.65  
1: d_y2_d_x2     0.226      0.350    0.65    0.52  
1: d_y3_d_x2    -0.241      0.330   -0.73    0.46  
1: d_y1_d_x3     0.511      0.290    1.74    0.08 .
1: d_y2_d_x3    -0.218      0.370   -0.58    0.56  
1: d_y3_d_x3     0.299      0.370    0.80    0.42  
1: d_y1_d_x4    -0.039      0.140   -0.28    0.78  
1: d_y2_d_x4    -0.525      0.520   -1.00    0.32  
1: d_y3_d_x4     0.346      0.580    0.60    0.55  
2: d_y1_d_x1     0.430      0.320    1.35    0.18  
2: d_y2_d_x1     0.190      0.330    0.58    0.56  
2: d_y3_d_x1    -0.132      0.250   -0.52    0.60  
2: d_y1_d_x2    -0.374      0.390   -0.95    0.34  
2: d_y2_d_x2     0.215      0.320    0.67    0.50  
2: d_y3_d_x2    -0.249      0.310   -0.80    0.43  
2: d_y1_d_x3     0.410      0.400    1.03    0.30  
2: d_y2_d_x3    -0.448      0.310   -1.42    0.15  
2: d_y3_d_x3     0.418      0.340    1.22    0.22  
2: d_y1_d_x4    -0.211      0.310   -0.68    0.50  
2: d_y2_d_x4    -0.513      0.360   -1.43    0.15  
2: d_y3_d_x4     0.446      0.310    1.43    0.15  
3: d_y1_d_x1     0.115      0.410    0.28    0.78  
3: d_y2_d_x1     0.368      0.350    1.05    0.30  
3: d_y3_d_x1    -0.203      0.350   -0.58    0.56  
3: d_y1_d_x2    -0.315      0.420   -0.74    0.46  
3: d_y2_d_x2     0.209      0.350    0.59    0.55  
3: d_y3_d_x2    -0.242      0.360   -0.67    0.50  
3: d_y1_d_x3     0.342      0.570    0.60    0.55  
3: d_y2_d_x3    -0.281      0.510   -0.55    0.58  
3: d_y3_d_x3     0.307      0.470    0.65    0.52  
3: d_y1_d_x4    -0.223      0.400   -0.56    0.58  
3: d_y2_d_x4    -0.251      0.680   -0.37    0.71  
3: d_y3_d_x4     0.206      0.580    0.36    0.72  
4: d_y1_d_x1     0.208      0.540    0.38    0.70  
4: d_y2_d_x1     0.383      0.360    1.07    0.28  
4: d_y3_d_x1    -0.229      0.360   -0.64    0.52  
4: d_y1_d_x2    -0.374      0.340   -1.11    0.27  
4: d_y2_d_x2     0.233      0.360    0.64    0.52  
4: d_y3_d_x2    -0.269      0.360   -0.76    0.45  
4: d_y1_d_x3     0.338      0.570    0.60    0.55  
4: d_y2_d_x3    -0.288      0.510   -0.56    0.57  
4: d_y3_d_x3     0.312      0.470    0.67    0.51  
4: d_y1_d_x4    -0.286      0.360   -0.80    0.42  
4: d_y2_d_x4    -0.361      0.710   -0.51    0.61  
4: d_y3_d_x4     0.289      0.610    0.48    0.63  
5: d_y1_d_x1     0.448      0.370    1.23    0.22  
5: d_y2_d_x1     0.313      0.480    0.65    0.51  
5: d_y3_d_x1    -0.209      0.420   -0.50    0.62  
5: d_y1_d_x2    -0.383      0.350   -1.10    0.27  
5: d_y2_d_x2     0.234      0.370    0.64    0.52  
5: d_y3_d_x2    -0.271      0.360   -0.76    0.45  
5: d_y1_d_x3     0.087      0.250    0.35    0.73  
5: d_y2_d_x3    -0.163      0.360   -0.45    0.65  
5: d_y3_d_x3     0.164      0.350    0.46    0.64  
5: d_y1_d_x4    -0.242      0.460   -0.53    0.60  
5: d_y2_d_x4    -0.549      0.430   -1.27    0.20  
5: d_y3_d_x4     0.445      0.380    1.16    0.25  
6: d_y1_d_x1     0.027      0.150    0.17    0.86  
6: d_y2_d_x1     0.151      0.460    0.33    0.74  
6: d_y3_d_x1    -0.076      0.270   -0.28    0.78  
6: d_y1_d_x2    -0.153      0.460   -0.33    0.74  
6: d_y2_d_x2     0.066      0.250    0.27    0.79  
6: d_y3_d_x2    -0.096      0.320   -0.30    0.77  
6: d_y1_d_x3     0.294      0.540    0.54    0.59  
6: d_y2_d_x3    -0.363      0.450   -0.80    0.42  
6: d_y3_d_x3     0.359      0.410    0.88    0.38  
6: d_y1_d_x4    -0.071      0.290   -0.25    0.81  
6: d_y2_d_x4    -0.076      0.370   -0.21    0.84  
6: d_y3_d_x4     0.069      0.340    0.20    0.84  
7: d_y1_d_x1     0.256      0.460    0.56    0.57  
7: d_y2_d_x1     0.157      0.440    0.36    0.72  
7: d_y3_d_x1    -0.133      0.380   -0.35    0.73  
7: d_y1_d_x2    -0.039      0.160   -0.23    0.81  
7: d_y2_d_x2     0.118      0.360    0.33    0.74  
7: d_y3_d_x2    -0.147      0.400   -0.36    0.72  
7: d_y1_d_x3     0.264      0.520    0.51    0.61  
7: d_y2_d_x3    -0.407      0.390   -1.05    0.29  
7: d_y3_d_x3     0.386      0.360    1.06    0.29  
7: d_y1_d_x4    -0.070      0.270   -0.25    0.80  
7: d_y2_d_x4    -0.444      0.570   -0.78    0.43  
7: d_y3_d_x4     0.358      0.470    0.76    0.45  
8: d_y1_d_x1     0.132      0.200    0.66    0.51  
8: d_y2_d_x1     0.377      0.390    0.98    0.33  
8: d_y3_d_x1    -0.226      0.400   -0.56    0.58  
8: d_y1_d_x2    -0.331      0.430   -0.76    0.45  
8: d_y2_d_x2     0.219      0.410    0.54    0.59  
8: d_y3_d_x2    -0.266      0.400   -0.66    0.51  
8: d_y1_d_x3     0.186      0.250    0.75    0.46  
8: d_y2_d_x3    -0.264      0.280   -0.96    0.34  
8: d_y3_d_x3     0.272      0.270    1.00    0.32  
8: d_y1_d_x4    -0.260      0.420   -0.62    0.53  
8: d_y2_d_x4    -0.208      0.270   -0.76    0.45  
8: d_y3_d_x4     0.221      0.260    0.84    0.40  
9: d_y1_d_x1     0.303      0.600    0.50    0.61  
9: d_y2_d_x1     0.030      0.120    0.25    0.80  
9: d_y3_d_x1    -0.027      0.100   -0.26    0.80  
9: d_y1_d_x2    -0.231      0.360   -0.63    0.53  
9: d_y2_d_x2     0.073      0.180    0.40    0.69  
9: d_y3_d_x2    -0.097      0.230   -0.43    0.67  
9: d_y1_d_x3     0.408      0.400    1.02    0.31  
9: d_y2_d_x3    -0.449      0.320   -1.42    0.16  
9: d_y3_d_x3     0.418      0.350    1.21    0.23  
9: d_y1_d_x4    -0.032      0.120   -0.26    0.79  
9: d_y2_d_x4    -0.507      0.570   -0.89    0.38  
9: d_y3_d_x4     0.327      0.590    0.55    0.58  
10: d_y1_d_x1    0.002      0.010    0.19    0.85  
10: d_y2_d_x1    0.243      0.510    0.48    0.63  
10: d_y3_d_x1   -0.128      0.370   -0.35    0.73  
10: d_y1_d_x2   -0.029      0.130   -0.23    0.82  
10: d_y2_d_x2    0.118      0.350    0.34    0.74  
10: d_y3_d_x2   -0.158      0.410   -0.39    0.70  
10: d_y1_d_x3    0.129      0.210    0.60    0.55  
10: d_y2_d_x3   -0.387      0.290   -1.32    0.19  
10: d_y3_d_x3    0.356      0.290    1.22    0.22  
10: d_y1_d_x4   -0.034      0.140   -0.24    0.81  
10: d_y2_d_x4   -0.018      0.070   -0.25    0.80  
10: d_y3_d_x4    0.029      0.100    0.28    0.78  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
> # now with mean values of the marginal effects
> margEffUncM <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), vcov = diag( 18 ), 
+    addMean = TRUE )
> all.equal( margEffUnc, margEffUncM[ 1:nObs, ], check.attributes = FALSE )
[1] TRUE
> round( margEffUncM[ nObs:(nObs+1), ], 3 )
     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10       0.002     0.243    -0.128    -0.029     0.118    -0.158     0.009
mean     0.210     0.243    -0.148    -0.236     0.171    -0.204     0.254
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10      -0.156     0.160    -0.005    -0.209     0.174
mean    -0.303     0.275    -0.145    -0.404     0.300
> all.equal( attr( margEffUnc, "vcov" ), 
+    attr( margEffUncM, "vcov" )[ 1:nObs, , ] )
[1] TRUE
> round( attr( margEffUncM, "vcov" )[ nObs:(nObs+1), , ], 2 )
, , d_y1_d_x1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10        0.00         0         0      0.00         0         0      0.00
mean      0.06         0         0     -0.01         0         0      0.01
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10           0         0      0.00         0         0
mean         0         0     -0.01         0         0

, , d_y2_d_x1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0      0.26         0         0      0.08         0         0
mean         0      0.07         0         0     -0.01         0         0
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10       -0.11         0         0     -0.20         0
mean      0.01         0         0     -0.03         0

, , d_y3_d_x1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0         0      0.13         0         0      0.06         0
mean         0         0      0.07         0         0     -0.01         0
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10           0     -0.06         0         0     -0.10
mean         0      0.01         0         0     -0.02

, , d_y1_d_x2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10        0.00         0         0      0.02         0         0      0.00
mean     -0.01         0         0      0.06         0         0      0.02
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10           0         0      0.00         0         0
mean         0         0     -0.01         0         0

, , d_y2_d_x2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0      0.08         0         0      0.12         0         0
mean         0     -0.01         0         0      0.08         0         0
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10       -0.06         0         0     -0.12         0
mean      0.03         0         0      0.01         0

, , d_y3_d_x2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0         0      0.06         0         0      0.17         0
mean         0         0     -0.01         0         0      0.09         0
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10           0     -0.07         0         0     -0.12
mean         0      0.03         0         0      0.00

, , d_y1_d_x3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10        0.00         0         0      0.00         0         0      0.00
mean      0.01         0         0      0.02         0         0      0.02
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10           0         0         0         0         0
mean         0         0         0         0         0

, , d_y2_d_x3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0     -0.11         0         0     -0.06         0         0
mean         0      0.01         0         0      0.03         0         0
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10        0.09         0         0      0.16         0
mean      0.02         0         0      0.01         0

, , d_y3_d_x3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0         0     -0.06         0         0     -0.07         0
mean         0         0      0.01         0         0      0.03         0
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10           0      0.08         0         0      0.12
mean         0      0.02         0         0      0.01

, , d_y1_d_x4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10        0.00         0         0      0.00         0         0         0
mean     -0.01         0         0     -0.01         0         0         0
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10           0         0      0.00         0         0
mean         0         0      0.04         0         0

, , d_y2_d_x4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0     -0.20         0         0     -0.12         0         0
mean         0     -0.03         0         0      0.01         0         0
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10        0.16         0         0      0.31         0
mean      0.01         0         0      0.17         0

, , d_y3_d_x4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
10           0         0     -0.10         0         0     -0.12         0
mean         0         0     -0.02         0         0      0.00         0
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
10           0      0.12         0         0      0.21
mean         0      0.01         0         0      0.14

> round( drop( attr( margEffUncM, "vcov" )[ nObs+1, , ] ), 2 )
          d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
d_y1_d_x1      0.06      0.00      0.00     -0.01      0.00      0.00      0.01
d_y2_d_x1      0.00      0.07      0.00      0.00     -0.01      0.00      0.00
d_y3_d_x1      0.00      0.00      0.07      0.00      0.00     -0.01      0.00
d_y1_d_x2     -0.01      0.00      0.00      0.06      0.00      0.00      0.02
d_y2_d_x2      0.00     -0.01      0.00      0.00      0.08      0.00      0.00
d_y3_d_x2      0.00      0.00     -0.01      0.00      0.00      0.09      0.00
d_y1_d_x3      0.01      0.00      0.00      0.02      0.00      0.00      0.02
d_y2_d_x3      0.00      0.01      0.00      0.00      0.03      0.00      0.00
d_y3_d_x3      0.00      0.00      0.01      0.00      0.00      0.03      0.00
d_y1_d_x4     -0.01      0.00      0.00     -0.01      0.00      0.00      0.00
d_y2_d_x4      0.00     -0.03      0.00      0.00      0.01      0.00      0.00
d_y3_d_x4      0.00      0.00     -0.02      0.00      0.00      0.00      0.00
          d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
d_y1_d_x1      0.00      0.00     -0.01      0.00      0.00
d_y2_d_x1      0.01      0.00      0.00     -0.03      0.00
d_y3_d_x1      0.00      0.01      0.00      0.00     -0.02
d_y1_d_x2      0.00      0.00     -0.01      0.00      0.00
d_y2_d_x2      0.03      0.00      0.00      0.01      0.00
d_y3_d_x2      0.00      0.03      0.00      0.00      0.00
d_y1_d_x3      0.00      0.00      0.00      0.00      0.00
d_y2_d_x3      0.02      0.00      0.00      0.01      0.00
d_y3_d_x3      0.00      0.02      0.00      0.00      0.01
d_y1_d_x4      0.00      0.00      0.04      0.00      0.00
d_y2_d_x4      0.01      0.00      0.00      0.17      0.00
d_y3_d_x4      0.00      0.01      0.00      0.00      0.14
> all.equal( summary( margEffUnc )[ , ], 
+    summary( margEffUncM )[ 1:( 12 * nObs ), ], check.attributes = FALSE )
[1] TRUE
> printCoefmat( round(
+   summary( margEffUncM )[ -( 1:( 12 * (nObs-1) ) ), ],
+   digits = 3 ), digits = 3 )
                Estimate Std. error z value Pr(> z)  
10: d_y1_d_x1      0.002      0.011    0.19   0.847  
10: d_y2_d_x1      0.243      0.509    0.48   0.633  
10: d_y3_d_x1     -0.128      0.366   -0.35   0.726  
10: d_y1_d_x2     -0.029      0.127   -0.23   0.818  
10: d_y2_d_x2      0.118      0.349    0.34   0.736  
10: d_y3_d_x2     -0.158      0.407   -0.39   0.699  
10: d_y1_d_x3      0.009      0.039    0.24   0.812  
10: d_y2_d_x3     -0.156      0.299   -0.52   0.601  
10: d_y3_d_x3      0.160      0.280    0.57   0.569  
10: d_y1_d_x4     -0.005      0.025   -0.22   0.827  
10: d_y2_d_x4     -0.209      0.559   -0.37   0.709  
10: d_y3_d_x4      0.174      0.464    0.38   0.707  
mean: d_y1_d_x1    0.210      0.248    0.85   0.397  
mean: d_y2_d_x1    0.243      0.264    0.92   0.357  
mean: d_y3_d_x1   -0.148      0.256   -0.58   0.562  
mean: d_y1_d_x2   -0.236      0.248   -0.95   0.342  
mean: d_y2_d_x2    0.171      0.286    0.60   0.549  
mean: d_y3_d_x2   -0.204      0.292   -0.70   0.486  
mean: d_y1_d_x3    0.254      0.141    1.80   0.072 .
mean: d_y2_d_x3   -0.303      0.145   -2.09   0.036 *
mean: d_y3_d_x3    0.275      0.151    1.83   0.068 .
mean: d_y1_d_x4   -0.145      0.197   -0.74   0.461  
mean: d_y2_d_x4   -0.404      0.407   -0.99   0.321  
mean: d_y3_d_x4    0.300      0.368    0.82   0.415  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
> 
> # for testing state of random number generator
> rnorm( 4 )
[1] -0.5075 -0.4008  0.9871 -1.2228
> 
> # calculating marginal effects, conditional
> # (assuming that all other dependent variables are one)
> margEffCond <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = GenzBretz() )
> round( margEffCond, 3 )
   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.412     0.118    -0.360    -0.229     0.246    -0.126     0.177
2      0.307     0.165    -0.221    -0.251     0.236    -0.173     0.471
3      0.267     0.227    -0.383    -0.358     0.230    -0.148     0.441
4      0.374     0.276    -0.356    -0.347     0.264    -0.156     0.520
5      0.439     0.271    -0.262    -0.321     0.263    -0.163     0.330
6      0.133     0.051    -0.384    -0.272     0.060    -0.110     0.254
7      0.119     0.145    -0.160    -0.009     0.113    -0.155     0.036
8      0.048     0.350    -0.234    -0.203     0.240    -0.177     0.147
9      0.549     0.018    -0.116    -0.323     0.074    -0.103     0.361
10     0.000     0.232    -0.130    -0.006     0.111    -0.166     0.001
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.352     0.223    -0.147    -0.329     0.604
2     -0.391     0.242    -0.401    -0.405     0.497
3     -0.337     0.235    -0.380    -0.325     0.572
4     -0.451     0.244    -0.414    -0.449     0.567
5     -0.505     0.279    -0.224    -0.568     0.488
6     -0.052     0.158    -0.278    -0.048     0.386
7     -0.310     0.298    -0.022    -0.399     0.357
8     -0.386     0.284    -0.091    -0.467     0.407
9     -0.071     0.142    -0.393    -0.066     0.334
10    -0.149     0.185    -0.001    -0.199     0.199
> margEffCondA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = GenzBretz() )
> all.equal( margEffCond, margEffCondA )
[1] TRUE
> # now with dummy variables specified explicitly
> margEffCondD <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    dummyVars = c( "x1", "x2" ), algorithm = GenzBretz() )
> all.equal( margEffCondD, margEffCond )
[1] TRUE
> # now with seemingly no dummy variables
> margEffCondD0 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    dummyVars = NULL, algorithm = GenzBretz() )
> round( margEffCondD0, 3 )
   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.188     0.171    -0.423    -0.126     0.188    -0.129     0.177
2      0.510     0.225    -0.326    -0.335     0.204    -0.147     0.471
3      0.482     0.173    -0.392    -0.315     0.179    -0.138     0.441
4      0.539     0.243    -0.384    -0.369     0.238    -0.146     0.520
5      0.308     0.329    -0.304    -0.231     0.261    -0.175     0.330
6      0.329     0.025    -0.266    -0.186     0.028    -0.091     0.254
7      0.031     0.247    -0.187    -0.025     0.155    -0.192     0.036
8      0.130     0.281    -0.234    -0.103     0.196    -0.181     0.147
9      0.466     0.035    -0.229    -0.265     0.038    -0.082     0.361
10     0.001     0.125    -0.097    -0.001     0.074    -0.120     0.001
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.352     0.223    -0.147    -0.329     0.604
2     -0.391     0.242    -0.401    -0.405     0.497
3     -0.337     0.235    -0.380    -0.325     0.572
4     -0.451     0.244    -0.414    -0.449     0.567
5     -0.505     0.279    -0.224    -0.568     0.488
6     -0.052     0.158    -0.278    -0.048     0.386
7     -0.310     0.298    -0.022    -0.399     0.357
8     -0.386     0.284    -0.091    -0.467     0.407
9     -0.071     0.142    -0.393    -0.066     0.334
10    -0.149     0.185    -0.001    -0.199     0.199
> # now with seemingly only dummy variables
> margEffCondDA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    dummyVars = c( "x1", "x2", "x3", "x4" ), algorithm = GenzBretz() )
> round( margEffCondDA, 3 )
   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.412     0.118    -0.360    -0.229     0.246    -0.126     0.432
2      0.307     0.165    -0.221    -0.251     0.236    -0.173     0.224
3      0.267     0.227    -0.383    -0.358     0.230    -0.148     0.188
4      0.374     0.276    -0.356    -0.347     0.264    -0.156     0.184
5      0.439     0.271    -0.262    -0.321     0.263    -0.163     0.027
6      0.133     0.051    -0.384    -0.272     0.060    -0.110     0.142
7      0.119     0.145    -0.160    -0.009     0.113    -0.155     0.115
8      0.048     0.350    -0.234    -0.203     0.240    -0.177     0.074
9      0.549     0.018    -0.116    -0.323     0.074    -0.103     0.221
10     0.000     0.232    -0.130    -0.006     0.111    -0.166     0.041
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.269     0.163    -0.142    -0.358     0.544
2     -0.462     0.308    -0.328    -0.490     0.435
3     -0.298     0.232    -0.447    -0.183     0.404
4     -0.304     0.237    -0.412    -0.294     0.443
5     -0.161     0.172    -0.165    -0.508     0.472
6     -0.369     0.284    -0.354    -0.037     0.290
7     -0.406     0.312    -0.021    -0.416     0.360
8     -0.264     0.241    -0.146    -0.205     0.233
9     -0.462     0.309    -0.127    -0.330     0.549
10    -0.374     0.320    -0.004    -0.017     0.047
> # now with integrals obtained by the Miwa algorithm, reduced precision
> margEffCond1 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    algorithm = Miwa( steps = 32 ) )
> round( margEffCond1, 3 )
   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.412     0.117    -0.360    -0.229     0.246    -0.126     0.177
2      0.307     0.165    -0.221    -0.251     0.236    -0.173     0.471
3      0.267     0.228    -0.384    -0.358     0.230    -0.148     0.441
4      0.374     0.276    -0.356    -0.347     0.264    -0.156     0.520
5      0.439     0.271    -0.262    -0.320     0.263    -0.163     0.330
6      0.133     0.051    -0.384    -0.271     0.060    -0.110     0.254
7      0.119     0.145    -0.160    -0.009     0.113    -0.155     0.036
8      0.048     0.350    -0.234    -0.203     0.240    -0.177     0.147
9      0.549     0.018    -0.116    -0.323     0.074    -0.103     0.361
10     0.000     0.232    -0.130    -0.006     0.111    -0.166     0.001
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.352     0.223    -0.147    -0.329     0.604
2     -0.391     0.242    -0.401    -0.405     0.497
3     -0.337     0.235    -0.380    -0.325     0.572
4     -0.451     0.244    -0.414    -0.449     0.568
5     -0.505     0.279    -0.224    -0.568     0.488
6     -0.052     0.158    -0.278    -0.048     0.386
7     -0.310     0.298    -0.022    -0.399     0.357
8     -0.386     0.284    -0.091    -0.467     0.407
9     -0.071     0.142    -0.393    -0.066     0.334
10    -0.149     0.185    -0.001    -0.199     0.199
> all.equal( margEffCond, margEffCond1, tol = 1e-3 )
[1] TRUE
> # now with integrals obtained by the GHK algorithm
> margEffCond2 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE )
> round( margEffCond2, 3 )
   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.411     0.117    -0.360    -0.229     0.246    -0.126     0.176
2      0.306     0.165    -0.221    -0.251     0.236    -0.173     0.470
3      0.267     0.228    -0.384    -0.358     0.231    -0.148     0.440
4      0.374     0.276    -0.356    -0.347     0.264    -0.156     0.520
5      0.439     0.271    -0.262    -0.320     0.263    -0.163     0.330
6      0.133     0.051    -0.384    -0.271     0.060    -0.110     0.253
7      0.119     0.145    -0.160    -0.009     0.113    -0.155     0.036
8      0.048     0.350    -0.234    -0.203     0.240    -0.177     0.147
9      0.545     0.017    -0.116    -0.323     0.074    -0.103     0.361
10     0.001     0.232    -0.130    -0.006     0.111    -0.166     0.001
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.352     0.223    -0.147    -0.329     0.604
2     -0.391     0.242    -0.400    -0.405     0.497
3     -0.337     0.235    -0.380    -0.325     0.572
4     -0.452     0.244    -0.414    -0.449     0.568
5     -0.505     0.279    -0.223    -0.568     0.488
6     -0.052     0.158    -0.278    -0.048     0.386
7     -0.310     0.298    -0.022    -0.399     0.358
8     -0.386     0.284    -0.091    -0.467     0.407
9     -0.071     0.141    -0.392    -0.066     0.334
10    -0.149     0.185    -0.001    -0.199     0.200
> all.equal( margEffCond, margEffCond2, tol = 1e-3 )
[1] "Component \"d_y1_d_x1\": Mean relative difference: 0.002442"
[2] "Component \"d_y1_d_x3\": Mean relative difference: 0.00105" 
[3] "Component \"d_y1_d_x4\": Mean relative difference: 0.002044"
> all.equal( margEffCond1, margEffCond2, tol = 1e-3 )
[1] "Component \"d_y1_d_x1\": Mean relative difference: 0.002494"
[2] "Component \"d_y1_d_x3\": Mean relative difference: 0.001127"
[3] "Component \"d_y1_d_x4\": Mean relative difference: 0.002149"
> # now with integrals obtained by the GHK algorithm, reduced precision
> margEffCond3 <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat ), cond = TRUE,
+    nGHK = 100 )
> round( margEffCond3, 3 )
   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.415     0.120    -0.360    -0.230     0.246    -0.126     0.177
2      0.319     0.172    -0.220    -0.252     0.236    -0.173     0.471
3      0.267     0.227    -0.383    -0.359     0.230    -0.148     0.441
4      0.375     0.276    -0.355    -0.348     0.264    -0.156     0.521
5      0.441     0.271    -0.261    -0.321     0.263    -0.163     0.331
6      0.134     0.053    -0.384    -0.272     0.061    -0.110     0.254
7      0.120     0.145    -0.160    -0.009     0.113    -0.154     0.037
8      0.049     0.350    -0.234    -0.204     0.240    -0.177     0.149
9      0.573     0.043    -0.116    -0.324     0.076    -0.104     0.362
10     0.000     0.232    -0.130    -0.006     0.111    -0.166     0.002
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.351     0.223    -0.147    -0.328     0.603
2     -0.392     0.242    -0.407    -0.408     0.496
3     -0.337     0.235    -0.382    -0.326     0.571
4     -0.451     0.244    -0.417    -0.449     0.567
5     -0.505     0.279    -0.226    -0.567     0.488
6     -0.056     0.158    -0.282    -0.059     0.385
7     -0.310     0.297    -0.022    -0.400     0.357
8     -0.386     0.284    -0.092    -0.467     0.407
9     -0.076     0.142    -0.400    -0.080     0.334
10    -0.149     0.185    -0.001    -0.200     0.199
> all.equal( margEffCond, margEffCond3, tol = 1e-3 )
 [1] "Component \"d_y1_d_x1\": Mean relative difference: 0.01725" 
 [2] "Component \"d_y2_d_x1\": Mean relative difference: 0.02084" 
 [3] "Component \"d_y3_d_x1\": Mean relative difference: 0.001415"
 [4] "Component \"d_y1_d_x2\": Mean relative difference: 0.002659"
 [5] "Component \"d_y2_d_x2\": Mean relative difference: 0.0026"  
 [6] "Component \"d_y1_d_x3\": Mean relative difference: 0.003312"
 [7] "Component \"d_y2_d_x3\": Mean relative difference: 0.003941"
 [8] "Component \"d_y1_d_x4\": Mean relative difference: 0.01059" 
 [9] "Component \"d_y2_d_x4\": Mean relative difference: 0.009373"
[10] "Component \"d_y3_d_x4\": Mean relative difference: 0.001292"
> all.equal( margEffCond2, margEffCond3, tol = 1e-3 )
 [1] "Component \"d_y1_d_x1\": Mean relative difference: 0.01974" 
 [2] "Component \"d_y2_d_x1\": Mean relative difference: 0.02169" 
 [3] "Component \"d_y3_d_x1\": Mean relative difference: 0.001724"
 [4] "Component \"d_y1_d_x2\": Mean relative difference: 0.003645"
 [5] "Component \"d_y2_d_x2\": Mean relative difference: 0.003015"
 [6] "Component \"d_y3_d_x2\": Mean relative difference: 0.00122" 
 [7] "Component \"d_y1_d_x3\": Mean relative difference: 0.004366"
 [8] "Component \"d_y2_d_x3\": Mean relative difference: 0.004112"
 [9] "Component \"d_y3_d_x3\": Mean relative difference: 0.001129"
[10] "Component \"d_y1_d_x4\": Mean relative difference: 0.01247" 
[11] "Component \"d_y2_d_x4\": Mean relative difference: 0.009524"
[12] "Component \"d_y3_d_x4\": Mean relative difference: 0.001516"
> # now with variance covariance matrix and Jacobian
> margEffCondV <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat )[ c(1,5,10), ], cond = TRUE, 
+    vcov = diag( 18 ), returnJacobian = TRUE, algorithm = GenzBretz() )
> round( attr( margEffCondV, "vcov" ), 2 )
, , d_y1_d_x1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.98      0.00     -0.45     -0.23      0.01      0.16      0.39
5       0.29      0.04     -0.06      0.03     -0.08      0.01      0.06
10      0.00      0.00      0.00      0.00      0.00      0.00      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      -0.05     -0.24     -0.49     -0.02      0.27
5       0.09     -0.02     -0.26     -0.04      0.08
10      0.00      0.00      0.00      0.00      0.00

, , d_y2_d_x1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.00      0.32      0.08      0.09     -0.01     -0.05     -0.04
5       0.04      0.26      0.05     -0.03     -0.05     -0.04      0.11
10      0.00      0.26      0.02      0.00      0.09      0.03      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      -0.37      0.04     -0.02     -0.65     -0.06
5      -0.09      0.04     -0.14     -0.08      0.05
10     -0.11     -0.04      0.00     -0.20     -0.04

, , d_y3_d_x1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.45      0.08      0.77      0.07     -0.01     -0.39     -0.06
5      -0.06      0.05      0.26     -0.10      0.01     -0.02      0.21
10      0.00      0.02      0.14      0.00      0.01      0.05      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      -0.08      0.47      0.19     -0.15     -0.38
5      -0.05     -0.08     -0.07     -0.03     -0.06
10     -0.01     -0.05      0.00     -0.01     -0.09

, , d_y1_d_x2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.23      0.09      0.07      0.24     -0.05     -0.11     -0.16
5       0.03     -0.03     -0.10      0.38     -0.07     -0.07     -0.37
10      0.00      0.00      0.00      0.00      0.00     -0.01      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      -0.07      0.03      0.14     -0.18     -0.03
5       0.06      0.01      0.16      0.01      0.02
10      0.00      0.00      0.00      0.00      0.01

, , d_y2_d_x2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.01     -0.01     -0.01     -0.05      0.12      0.04      0.01
5      -0.08     -0.05      0.01     -0.07      0.18      0.04     -0.01
10      0.00      0.09      0.01      0.00      0.12      0.03      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.02     -0.01      0.00      0.00     -0.01
5      -0.05      0.00      0.09      0.00      0.00
10     -0.07     -0.03      0.00     -0.12     -0.03

, , d_y3_d_x2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.16     -0.05     -0.39     -0.11      0.04      0.39      0.01
5       0.01     -0.04     -0.02     -0.07      0.04      0.29     -0.07
10      0.00      0.03      0.05     -0.01      0.03      0.19      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.04     -0.26     -0.07      0.11      0.15
5       0.01     -0.14     -0.02      0.06      0.01
10     -0.02     -0.09      0.00     -0.03     -0.14

, , d_y1_d_x3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.39     -0.04     -0.06     -0.16      0.01      0.01      0.30
5       0.06      0.11      0.21     -0.37     -0.01     -0.07      0.89
10      0.00      0.00      0.00      0.00      0.00      0.00      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      -0.01     -0.09     -0.27      0.09      0.05
5      -0.13     -0.08     -0.49     -0.04     -0.01
10      0.00      0.00      0.00      0.00      0.00

, , d_y2_d_x3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.05     -0.37     -0.08     -0.07      0.02      0.04     -0.01
5       0.09     -0.09     -0.05      0.06     -0.05      0.01     -0.13
10      0.00     -0.11     -0.01      0.00     -0.07     -0.02      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.53      0.03      0.05      0.79      0.08
5       0.37      0.03     -0.04      0.04     -0.03
10      0.09      0.03      0.00      0.16      0.03

, , d_y3_d_x3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.24      0.04      0.47      0.03     -0.01     -0.26     -0.09
5      -0.02      0.04     -0.08      0.01      0.00     -0.14     -0.08
10      0.00     -0.04     -0.05      0.00     -0.03     -0.09      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.03      0.54      0.12     -0.08     -0.18
5       0.03      0.44      0.09     -0.09      0.04
10      0.03      0.13      0.00      0.04      0.17

, , d_y1_d_x4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.49     -0.02      0.19      0.14      0.00     -0.07     -0.27
5      -0.26     -0.14     -0.07      0.16      0.09     -0.02     -0.49
10      0.00      0.00      0.00      0.00      0.00      0.00      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.05      0.12      0.35      0.02     -0.19
5      -0.04      0.09      0.65      0.04     -0.14
10      0.00      0.00      0.00      0.00      0.00

, , d_y2_d_x4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.02     -0.65     -0.15     -0.18      0.00      0.11      0.09
5      -0.04     -0.08     -0.03      0.01      0.00      0.06     -0.04
10      0.00     -0.20     -0.01      0.00     -0.12     -0.03      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.79     -0.08      0.02      1.46      0.13
5       0.04     -0.09      0.04      0.25     -0.05
10      0.16      0.04      0.00      0.30      0.05

, , d_y3_d_x4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.27     -0.06     -0.38     -0.03     -0.01      0.15      0.05
5       0.08      0.05     -0.06      0.02      0.00      0.01     -0.01
10      0.00     -0.04     -0.09      0.01     -0.03     -0.14      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.08     -0.18     -0.19      0.13      0.44
5      -0.03      0.04     -0.14     -0.05      0.23
10      0.03      0.17      0.00      0.05      0.29

> round( drop( attr( margEffCondV, "vcov" )[ 1, , ] ), 2 )
          d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
d_y1_d_x1      0.98      0.00     -0.45     -0.23      0.01      0.16      0.39
d_y2_d_x1      0.00      0.32      0.08      0.09     -0.01     -0.05     -0.04
d_y3_d_x1     -0.45      0.08      0.77      0.07     -0.01     -0.39     -0.06
d_y1_d_x2     -0.23      0.09      0.07      0.24     -0.05     -0.11     -0.16
d_y2_d_x2      0.01     -0.01     -0.01     -0.05      0.12      0.04      0.01
d_y3_d_x2      0.16     -0.05     -0.39     -0.11      0.04      0.39      0.01
d_y1_d_x3      0.39     -0.04     -0.06     -0.16      0.01      0.01      0.30
d_y2_d_x3     -0.05     -0.37     -0.08     -0.07      0.02      0.04     -0.01
d_y3_d_x3     -0.24      0.04      0.47      0.03     -0.01     -0.26     -0.09
d_y1_d_x4     -0.49     -0.02      0.19      0.14      0.00     -0.07     -0.27
d_y2_d_x4     -0.02     -0.65     -0.15     -0.18      0.00      0.11      0.09
d_y3_d_x4      0.27     -0.06     -0.38     -0.03     -0.01      0.15      0.05
          d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
d_y1_d_x1     -0.05     -0.24     -0.49     -0.02      0.27
d_y2_d_x1     -0.37      0.04     -0.02     -0.65     -0.06
d_y3_d_x1     -0.08      0.47      0.19     -0.15     -0.38
d_y1_d_x2     -0.07      0.03      0.14     -0.18     -0.03
d_y2_d_x2      0.02     -0.01      0.00      0.00     -0.01
d_y3_d_x2      0.04     -0.26     -0.07      0.11      0.15
d_y1_d_x3     -0.01     -0.09     -0.27      0.09      0.05
d_y2_d_x3      0.53      0.03      0.05      0.79      0.08
d_y3_d_x3      0.03      0.54      0.12     -0.08     -0.18
d_y1_d_x4      0.05      0.12      0.35      0.02     -0.19
d_y2_d_x4      0.79     -0.08      0.02      1.46      0.13
d_y3_d_x4      0.08     -0.18     -0.19      0.13      0.44
> round( attr( margEffCondV, "jacobian" ), 2 )
, , b_1_0

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.28      0.04      0.08     -0.23      0.02     -0.02      0.28
5      -0.16      0.00     -0.01      0.18     -0.02     -0.04     -0.37
10      0.00      0.00      0.00      0.02      0.00     -0.01      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      -0.07      0.01     -0.23     -0.07      0.00
5       0.05      0.09      0.24     -0.01     -0.02
10      0.00      0.00      0.00      0.00      0.00

, , b_1_1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.43     -0.02     -0.08      0.00      0.00      0.00      0.00
5       0.26     -0.04     -0.08      0.18     -0.02     -0.04     -0.37
10      0.00      0.00      0.00      0.00      0.00      0.00      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.00      0.00      0.00      0.00      0.00
5       0.05      0.09      0.24     -0.02     -0.02
10      0.00      0.00      0.00      0.00      0.00

, , b_1_2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.28      0.04      0.08      0.15     -0.06     -0.16      0.28
5       0.00      0.00      0.00      0.43     -0.06     -0.13      0.00
10      0.00      0.00      0.00      0.02      0.00     -0.01      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      -0.07      0.01     -0.23     -0.07         0
5       0.00      0.00      0.00      0.00         0
10      0.00      0.00      0.00      0.00         0

, , b_1_3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       -0.3     -0.04     -0.08      0.24     -0.02      0.02     -0.15
5        0.1      0.00      0.01     -0.11      0.01      0.03      0.48
10       0.0      0.00      0.00      0.02     -0.01     -0.02      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.02     -0.17      0.25      0.07      0.00
5      -0.07     -0.14     -0.15      0.01      0.01
10      0.00      0.00      0.00      0.00      0.00

, , b_1_4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.12      0.02      0.03     -0.10      0.01     -0.01      0.12
5      -0.13      0.00     -0.01      0.14     -0.01     -0.04     -0.30
10      0.00      0.00      0.00     -0.01      0.00      0.01      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      -0.03      0.01      0.05     -0.09     -0.16
5       0.04      0.07      0.46     -0.06     -0.10
10      0.00      0.00      0.00      0.00      0.00

, , b_2_0

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.01     -0.15     -0.02      0.04     -0.14     -0.01     -0.04
5       0.03      0.14      0.01     -0.01     -0.05      0.00      0.05
10      0.00      0.22      0.01      0.00      0.13      0.01      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.35      0.03      0.01      0.33      0.03
5      -0.08      0.00     -0.05     -0.08      0.01
10     -0.23     -0.02      0.00     -0.30     -0.02

, , b_2_1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.03      0.10      0.01      0.00      0.00         0      0.00
5      -0.04      0.40      0.04     -0.01     -0.05         0      0.05
10      0.00      0.35      0.02      0.00      0.00         0      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.00         0      0.00      0.00      0.00
5      -0.08         0     -0.05     -0.08      0.01
10      0.00         0      0.00      0.00      0.00

, , b_2_2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.01     -0.15     -0.02     -0.02      0.26      0.03     -0.04
5       0.00      0.00      0.00     -0.06      0.35      0.03      0.00
10      0.00      0.00      0.00      0.00      0.26      0.03      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.35      0.03      0.01      0.33      0.03
5       0.00      0.00      0.00      0.00      0.00
10      0.00      0.00      0.00      0.00      0.00

, , b_2_3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.01      0.16      0.02     -0.04      0.15      0.01      0.03
5      -0.02     -0.09     -0.01      0.01      0.03      0.00     -0.07
10      0.00      0.28      0.01      0.00      0.17      0.02      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      -0.12     -0.01     -0.01     -0.35     -0.03
5       0.45      0.04      0.03      0.05     -0.01
10     -0.16     -0.01      0.00     -0.38     -0.02

, , b_2_4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.00     -0.07     -0.01      0.02     -0.06     -0.01     -0.02
5       0.03      0.12      0.01     -0.01     -0.04      0.00      0.04
10      0.00     -0.08      0.00      0.00     -0.05      0.00      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.15      0.01     -0.01      0.40      0.04
5      -0.07      0.00     -0.08      0.33      0.04
10      0.09      0.01      0.00      0.24      0.02

, , b_3_0

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.10     -0.02     -0.17      0.06     -0.01      0.03     -0.08
5       0.01      0.02      0.18     -0.06      0.01      0.02      0.12
10      0.00      0.01      0.12      0.00      0.01      0.15      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.03     -0.01      0.08      0.02     -0.03
5      -0.03     -0.10     -0.04     -0.02     -0.14
10     -0.01     -0.23      0.00     -0.01     -0.25

, , b_3_1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.15      0.01      0.26      0.00      0.00      0.00      0.00
5      -0.07      0.03      0.40     -0.06      0.01      0.02      0.12
10      0.00      0.01      0.31      0.00      0.00      0.00      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.00       0.0      0.00      0.00      0.00
5      -0.03      -0.1     -0.04     -0.02     -0.14
10      0.00       0.0      0.00      0.00      0.00

, , b_3_2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       -0.1     -0.02     -0.17     -0.05      0.03      0.43     -0.08
5        0.0      0.00      0.00     -0.13      0.04      0.42      0.00
10       0.0      0.00      0.00      0.00      0.01      0.34      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.03     -0.02      0.08      0.02     -0.03
5       0.00      0.00      0.00      0.00      0.00
10      0.00      0.00      0.00      0.00      0.00

, , b_3_3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.11      0.02      0.18     -0.06      0.01     -0.03      0.04
5      -0.01     -0.01     -0.11      0.04      0.00     -0.01     -0.14
10      0.00      0.01      0.16     -0.01      0.01      0.19      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      -0.01      0.45     -0.09     -0.02      0.04
5       0.05      0.46      0.03      0.01      0.09
10     -0.01     -0.10      0.00     -0.02     -0.31

, , b_3_4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.04     -0.01     -0.07      0.02      0.00      0.01     -0.03
5       0.01      0.02      0.15     -0.05      0.01      0.02      0.10
10      0.00      0.00     -0.05      0.00      0.00     -0.06      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.01     -0.01     -0.01      0.04      0.42
5      -0.02     -0.08     -0.10      0.02      0.28
10      0.00      0.09      0.00      0.01      0.28

, , R_1_2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.01     -0.47     -0.02     -0.24      0.04      0.05      0.19
5      -0.39     -0.13      0.01     -0.03      0.20      0.04     -0.14
10      0.00      0.00      0.00      0.03      0.01     -0.02     -0.01
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.46     -0.04      0.00      0.96      0.02
5      -0.30     -0.03      0.51      0.11     -0.07
10      0.00      0.01      0.01      0.00      0.00

, , R_1_3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.68     -0.04     -0.75     -0.15      0.01      0.39      0.22
5       0.11     -0.03     -0.13      0.25      0.00      0.25     -0.44
10      0.00      0.00      0.00      0.02      0.00      0.01      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.01     -0.52     -0.39      0.09      0.45
5       0.02     -0.31     -0.03      0.04      0.18
10      0.00      0.00      0.00      0.00      0.00

, , R_2_3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.03     -0.03     -0.08      0.09     -0.04     -0.12     -0.10
5       0.05      0.18      0.04     -0.04      0.05     -0.14      0.11
10      0.00      0.11      0.00     -0.01      0.09      0.13      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.17      0.20      0.04      0.01      0.17
5      -0.20      0.24     -0.12     -0.32      0.23
10     -0.08     -0.25      0.00     -0.10     -0.22

> round( drop( attr( margEffCondV, "jacobian" )[ 1, , ] ), 2 )
          b_1_0 b_1_1 b_1_2 b_1_3 b_1_4 b_2_0 b_2_1 b_2_2 b_2_3 b_2_4 b_3_0
d_y1_d_x1  0.28  0.43  0.28 -0.30  0.12 -0.01 -0.03 -0.01  0.01  0.00 -0.10
d_y2_d_x1  0.04 -0.02  0.04 -0.04  0.02 -0.15  0.10 -0.15  0.16 -0.07 -0.02
d_y3_d_x1  0.08 -0.08  0.08 -0.08  0.03 -0.02  0.01 -0.02  0.02 -0.01 -0.17
d_y1_d_x2 -0.23  0.00  0.15  0.24 -0.10  0.04  0.00 -0.02 -0.04  0.02  0.06
d_y2_d_x2  0.02  0.00 -0.06 -0.02  0.01 -0.14  0.00  0.26  0.15 -0.06 -0.01
d_y3_d_x2 -0.02  0.00 -0.16  0.02 -0.01 -0.01  0.00  0.03  0.01 -0.01  0.03
d_y1_d_x3  0.28  0.00  0.28 -0.15  0.12 -0.04  0.00 -0.04  0.03 -0.02 -0.08
d_y2_d_x3 -0.07  0.00 -0.07  0.02 -0.03  0.35  0.00  0.35 -0.12  0.15  0.03
d_y3_d_x3  0.01  0.00  0.01 -0.17  0.01  0.03  0.00  0.03 -0.01  0.01 -0.01
d_y1_d_x4 -0.23  0.00 -0.23  0.25  0.05  0.01  0.00  0.01 -0.01 -0.01  0.08
d_y2_d_x4 -0.07  0.00 -0.07  0.07 -0.09  0.33  0.00  0.33 -0.35  0.40  0.02
d_y3_d_x4  0.00  0.00  0.00  0.00 -0.16  0.03  0.00  0.03 -0.03  0.04 -0.03
          b_3_1 b_3_2 b_3_3 b_3_4 R_1_2 R_1_3 R_2_3
d_y1_d_x1 -0.15 -0.10  0.11 -0.04  0.01  0.68 -0.03
d_y2_d_x1  0.01 -0.02  0.02 -0.01 -0.47 -0.04 -0.03
d_y3_d_x1  0.26 -0.17  0.18 -0.07 -0.02 -0.75 -0.08
d_y1_d_x2  0.00 -0.05 -0.06  0.02 -0.24 -0.15  0.09
d_y2_d_x2  0.00  0.03  0.01  0.00  0.04  0.01 -0.04
d_y3_d_x2  0.00  0.43 -0.03  0.01  0.05  0.39 -0.12
d_y1_d_x3  0.00 -0.08  0.04 -0.03  0.19  0.22 -0.10
d_y2_d_x3  0.00  0.03 -0.01  0.01  0.46  0.01  0.17
d_y3_d_x3  0.00 -0.02  0.45 -0.01 -0.04 -0.52  0.20
d_y1_d_x4  0.00  0.08 -0.09 -0.01  0.00 -0.39  0.04
d_y2_d_x4  0.00  0.02 -0.02  0.04  0.96  0.09  0.01
d_y3_d_x4  0.00 -0.03  0.04  0.42  0.02  0.45  0.17
> print( summary( margEffCondV ), digits = c( 3, 3, 2, 2, 2 ) )
             Estimate Std. error z value Pr(> z)
1: d_y1_d_x1    0.412      0.990    0.42    0.68
1: d_y2_d_x1    0.118      0.570    0.21    0.84
1: d_y3_d_x1   -0.360      0.870   -0.41    0.68
1: d_y1_d_x2   -0.229      0.490   -0.46    0.64
1: d_y2_d_x2    0.246      0.350    0.71    0.48
1: d_y3_d_x2   -0.126      0.620   -0.20    0.84
1: d_y1_d_x3    0.177      0.550    0.32    0.75
1: d_y2_d_x3   -0.352      0.730   -0.48    0.63
1: d_y3_d_x3    0.223      0.740    0.30    0.76
1: d_y1_d_x4   -0.147      0.590   -0.25    0.80
1: d_y2_d_x4   -0.329      1.210   -0.27    0.79
1: d_y3_d_x4    0.604      0.660    0.91    0.36
2: d_y1_d_x1    0.439      0.540    0.81    0.42
2: d_y2_d_x1    0.271      0.510    0.53    0.59
2: d_y3_d_x1   -0.262      0.510   -0.51    0.61
2: d_y1_d_x2   -0.321      0.620   -0.52    0.60
2: d_y2_d_x2    0.263      0.430    0.62    0.54
2: d_y3_d_x2   -0.163      0.540   -0.30    0.76
2: d_y1_d_x3    0.330      0.940    0.35    0.73
2: d_y2_d_x3   -0.505      0.610   -0.83    0.40
2: d_y3_d_x3    0.279      0.670    0.42    0.67
2: d_y1_d_x4   -0.224      0.810   -0.28    0.78
2: d_y2_d_x4   -0.568      0.500   -1.14    0.26
2: d_y3_d_x4    0.488      0.480    1.02    0.31
3: d_y1_d_x1    0.000      0.000    0.07    0.94
3: d_y2_d_x1    0.232      0.510    0.45    0.65
3: d_y3_d_x1   -0.130      0.370   -0.35    0.73
3: d_y1_d_x2   -0.006      0.050   -0.10    0.92
3: d_y2_d_x2    0.111      0.350    0.32    0.75
3: d_y3_d_x2   -0.166      0.440   -0.38    0.71
3: d_y1_d_x3    0.001      0.010    0.08    0.94
3: d_y2_d_x3   -0.149      0.300   -0.50    0.62
3: d_y3_d_x3    0.185      0.370    0.51    0.61
3: d_y1_d_x4   -0.001      0.010   -0.07    0.94
3: d_y2_d_x4   -0.199      0.550   -0.36    0.72
3: d_y3_d_x4    0.199      0.530    0.37    0.71
> margEffCondVA <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat )[ c(1,5,10), ], cond = TRUE, 
+    vcov = diag( 18 ), returnJacobian = TRUE, algorithm = GenzBretz() )
> all.equal( margEffCondV, margEffCondVA, tol = 1e-3 )
[1] TRUE
> # now with Jacobian but without variance covariance matrix
> margEffCondJac <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = allCoef,
+    data = as.data.frame( xMat )[ c(1,5,10), ], cond = TRUE, 
+    returnJacobian = TRUE, algorithm = GenzBretz() )
> all.equal( attr( margEffCondJac, "jacobian" ), attr( margEffCondV, "jacobian" ) )
[1] TRUE
> # now with mean values of marginal effects
> margEffCondM <- mvProbitMargEff( ~ x1 + x2 + x3 + x4, coef = c( beta ), 
+    sigma = sigma, data = as.data.frame( xMat )[ c(1,5,10), ], cond = TRUE, 
+    vcov = diag( 18 ), addMean = TRUE, returnJacobian = TRUE,
+    algorithm = GenzBretz() )
> all.equal( margEffCondV, margEffCondM[ 1:3, ], check.attributes = FALSE )
[1] TRUE
> round( margEffCondM, 3 )
     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        0.412     0.118    -0.360    -0.229     0.246    -0.126     0.177
2        0.439     0.271    -0.262    -0.321     0.263    -0.163     0.330
3        0.000     0.232    -0.130    -0.006     0.111    -0.166     0.001
mean     0.284     0.207    -0.251    -0.185     0.207    -0.152     0.169
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       -0.352     0.223    -0.147    -0.329     0.604
2       -0.505     0.279    -0.224    -0.568     0.488
3       -0.149     0.185    -0.001    -0.199     0.199
mean    -0.335     0.229    -0.124    -0.365     0.431
> all.equal( attr( margEffCondV, "vcov" ), 
+    attr( margEffCondM, "vcov" )[ 1:3, , ] )
[1] TRUE
> round( attr( margEffCondM, "vcov" ), 2 )
, , d_y1_d_x1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.98      0.00     -0.45     -0.23      0.01      0.16      0.39
5         0.29      0.04     -0.06      0.03     -0.08      0.01      0.06
10        0.00      0.00      0.00      0.00      0.00      0.00      0.00
mean      0.16      0.01     -0.11      0.05     -0.02      0.03     -0.05
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1        -0.05     -0.24     -0.49     -0.02      0.27
5         0.09     -0.02     -0.26     -0.04      0.08
10        0.00      0.00      0.00      0.00      0.00
mean      0.00     -0.04     -0.05     -0.04      0.06

, , d_y2_d_x1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.00      0.32      0.08      0.09     -0.01     -0.05     -0.04
5         0.04      0.26      0.05     -0.03     -0.05     -0.04      0.11
10        0.00      0.26      0.02      0.00      0.09      0.03      0.00
mean      0.01      0.15      0.02      0.01     -0.02     -0.02      0.01
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1        -0.37      0.04     -0.02     -0.65     -0.06
5        -0.09      0.04     -0.14     -0.08      0.05
10       -0.11     -0.04      0.00     -0.20     -0.04
mean     -0.02      0.02     -0.04     -0.13      0.00

, , d_y3_d_x1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.45      0.08      0.77      0.07     -0.01     -0.39     -0.06
5        -0.06      0.05      0.26     -0.10      0.01     -0.02      0.21
10        0.00      0.02      0.14      0.00      0.01      0.05      0.00
mean     -0.11      0.02      0.21     -0.02      0.00     -0.08      0.04
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1        -0.08      0.47      0.19     -0.15     -0.38
5        -0.05     -0.08     -0.07     -0.03     -0.06
10       -0.01     -0.05      0.00     -0.01     -0.09
mean     -0.01      0.09      0.03     -0.02     -0.09

, , d_y1_d_x2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.23      0.09      0.07      0.24     -0.05     -0.11     -0.16
5         0.03     -0.03     -0.10      0.38     -0.07     -0.07     -0.37
10        0.00      0.00      0.00      0.00      0.00     -0.01      0.00
mean      0.05      0.01     -0.02      0.06     -0.02     -0.04      0.01
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1        -0.07      0.03      0.14     -0.18     -0.03
5         0.06      0.01      0.16      0.01      0.02
10        0.00      0.00      0.00      0.00      0.01
mean     -0.01     -0.01     -0.03     -0.03      0.01

, , d_y2_d_x2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.01     -0.01     -0.01     -0.05      0.12      0.04      0.01
5        -0.08     -0.05      0.01     -0.07      0.18      0.04     -0.01
10        0.00      0.09      0.01      0.00      0.12      0.03      0.00
mean     -0.02     -0.02      0.00     -0.02      0.11      0.03     -0.01
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.02     -0.01      0.00      0.00     -0.01
5        -0.05      0.00      0.09      0.00      0.00
10       -0.07     -0.03      0.00     -0.12     -0.03
mean      0.04      0.00      0.02      0.02      0.00

, , d_y3_d_x2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.16     -0.05     -0.39     -0.11      0.04      0.39      0.01
5         0.01     -0.04     -0.02     -0.07      0.04      0.29     -0.07
10        0.00      0.03      0.05     -0.01      0.03      0.19      0.00
mean      0.03     -0.02     -0.08     -0.04      0.03      0.23     -0.03
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.04     -0.26     -0.07      0.11      0.15
5         0.01     -0.14     -0.02      0.06      0.01
10       -0.02     -0.09      0.00     -0.03     -0.14
mean      0.02     -0.07     -0.01      0.03      0.02

, , d_y1_d_x3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.39     -0.04     -0.06     -0.16      0.01      0.01      0.30
5         0.06      0.11      0.21     -0.37     -0.01     -0.07      0.89
10        0.00      0.00      0.00      0.00      0.00      0.00      0.00
mean     -0.05      0.01      0.04      0.01     -0.01     -0.03      0.05
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1        -0.01     -0.09     -0.27      0.09      0.05
5        -0.13     -0.08     -0.49     -0.04     -0.01
10        0.00      0.00      0.00      0.00      0.00
mean     -0.01     -0.01     -0.01      0.01      0.00

, , d_y2_d_x3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.05     -0.37     -0.08     -0.07      0.02      0.04     -0.01
5         0.09     -0.09     -0.05      0.06     -0.05      0.01     -0.13
10        0.00     -0.11     -0.01      0.00     -0.07     -0.02      0.00
mean      0.00     -0.02     -0.01     -0.01      0.04      0.02     -0.01
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.53      0.03      0.05      0.79      0.08
5         0.37      0.03     -0.04      0.04     -0.03
10        0.09      0.03      0.00      0.16      0.03
mean      0.03      0.00      0.01      0.04      0.00

, , d_y3_d_x3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.24      0.04      0.47      0.03     -0.01     -0.26     -0.09
5        -0.02      0.04     -0.08      0.01      0.00     -0.14     -0.08
10        0.00     -0.04     -0.05      0.00     -0.03     -0.09      0.00
mean     -0.04      0.02      0.09     -0.01      0.00     -0.07     -0.01
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.03      0.54      0.12     -0.08     -0.18
5         0.03      0.44      0.09     -0.09      0.04
10        0.03      0.13      0.00      0.04      0.17
mean      0.00      0.18      0.03     -0.03     -0.06

, , d_y1_d_x4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.49     -0.02      0.19      0.14      0.00     -0.07     -0.27
5        -0.26     -0.14     -0.07      0.16      0.09     -0.02     -0.49
10        0.00      0.00      0.00      0.00      0.00      0.00      0.00
mean     -0.05     -0.04      0.03     -0.03      0.02     -0.01     -0.01
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.05      0.12      0.35      0.02     -0.19
5        -0.04      0.09      0.65      0.04     -0.14
10        0.00      0.00      0.00      0.00      0.00
mean      0.01      0.03      0.10      0.04     -0.06

, , d_y2_d_x4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.02     -0.65     -0.15     -0.18      0.00      0.11      0.09
5        -0.04     -0.08     -0.03      0.01      0.00      0.06     -0.04
10        0.00     -0.20     -0.01      0.00     -0.12     -0.03      0.00
mean     -0.04     -0.13     -0.02     -0.03      0.02      0.03      0.01
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.79     -0.08      0.02      1.46      0.13
5         0.04     -0.09      0.04      0.25     -0.05
10        0.16      0.04      0.00      0.30      0.05
mean      0.04     -0.03      0.04      0.32      0.02

, , d_y3_d_x4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.27     -0.06     -0.38     -0.03     -0.01      0.15      0.05
5         0.08      0.05     -0.06      0.02      0.00      0.01     -0.01
10        0.00     -0.04     -0.09      0.01     -0.03     -0.14      0.00
mean      0.06      0.00     -0.09      0.01      0.00      0.02      0.00
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.08     -0.18     -0.19      0.13      0.44
5        -0.03      0.04     -0.14     -0.05      0.23
10        0.03      0.17      0.00      0.05      0.29
mean      0.00     -0.06     -0.06      0.02      0.19

> round( drop( attr( margEffCondM, "vcov" )[ 4, , ] ), 2 )
          d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
d_y1_d_x1      0.16      0.01     -0.11      0.05     -0.02      0.03     -0.05
d_y2_d_x1      0.01      0.15      0.02      0.01     -0.02     -0.02      0.01
d_y3_d_x1     -0.11      0.02      0.21     -0.02      0.00     -0.08      0.04
d_y1_d_x2      0.05      0.01     -0.02      0.06     -0.02     -0.04      0.01
d_y2_d_x2     -0.02     -0.02      0.00     -0.02      0.11      0.03     -0.01
d_y3_d_x2      0.03     -0.02     -0.08     -0.04      0.03      0.23     -0.03
d_y1_d_x3     -0.05      0.01      0.04      0.01     -0.01     -0.03      0.05
d_y2_d_x3      0.00     -0.02     -0.01     -0.01      0.04      0.02     -0.01
d_y3_d_x3     -0.04      0.02      0.09     -0.01      0.00     -0.07     -0.01
d_y1_d_x4     -0.05     -0.04      0.03     -0.03      0.02     -0.01     -0.01
d_y2_d_x4     -0.04     -0.13     -0.02     -0.03      0.02      0.03      0.01
d_y3_d_x4      0.06      0.00     -0.09      0.01      0.00      0.02      0.00
          d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
d_y1_d_x1      0.00     -0.04     -0.05     -0.04      0.06
d_y2_d_x1     -0.02      0.02     -0.04     -0.13      0.00
d_y3_d_x1     -0.01      0.09      0.03     -0.02     -0.09
d_y1_d_x2     -0.01     -0.01     -0.03     -0.03      0.01
d_y2_d_x2      0.04      0.00      0.02      0.02      0.00
d_y3_d_x2      0.02     -0.07     -0.01      0.03      0.02
d_y1_d_x3     -0.01     -0.01     -0.01      0.01      0.00
d_y2_d_x3      0.03      0.00      0.01      0.04      0.00
d_y3_d_x3      0.00      0.18      0.03     -0.03     -0.06
d_y1_d_x4      0.01      0.03      0.10      0.04     -0.06
d_y2_d_x4      0.04     -0.03      0.04      0.32      0.02
d_y3_d_x4      0.00     -0.06     -0.06      0.02      0.19
> all.equal( attr( margEffCondV, "jacobian" ), 
+    attr( margEffCondM, "jacobian" )[ 1:3, , ] )
[1] TRUE
> round( attr( margEffCondM, "jacobian" ), 2 )
, , b_1_0

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.28      0.04      0.08     -0.23      0.02     -0.02      0.28
5        -0.16      0.00     -0.01      0.18     -0.02     -0.04     -0.37
10        0.00      0.00      0.00      0.02      0.00     -0.01      0.00
mean      0.04      0.01      0.02     -0.01      0.00     -0.03     -0.03
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1        -0.07      0.01     -0.23     -0.07      0.00
5         0.05      0.09      0.24     -0.01     -0.02
10        0.00      0.00      0.00      0.00      0.00
mean     -0.01      0.04      0.00     -0.03     -0.01

, , b_1_1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.43     -0.02     -0.08      0.00      0.00      0.00      0.00
5         0.26     -0.04     -0.08      0.18     -0.02     -0.04     -0.37
10        0.00      0.00      0.00      0.00      0.00      0.00      0.00
mean      0.23     -0.02     -0.05      0.06     -0.01     -0.01     -0.12
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.00      0.00      0.00      0.00      0.00
5         0.05      0.09      0.24     -0.02     -0.02
10        0.00      0.00      0.00      0.00      0.00
mean      0.02      0.03      0.08     -0.01     -0.01

, , b_1_2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.28      0.04      0.08      0.15     -0.06     -0.16      0.28
5         0.00      0.00      0.00      0.43     -0.06     -0.13      0.00
10        0.00      0.00      0.00      0.02      0.00     -0.01      0.00
mean      0.09      0.01      0.03      0.20     -0.04     -0.10      0.09
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1        -0.07      0.01     -0.23     -0.07         0
5         0.00      0.00      0.00      0.00         0
10        0.00      0.00      0.00      0.00         0
mean     -0.02      0.00     -0.08     -0.02         0

, , b_1_3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.30     -0.04     -0.08      0.24     -0.02      0.02     -0.15
5         0.10      0.00      0.01     -0.11      0.01      0.03      0.48
10        0.00      0.00      0.00      0.02     -0.01     -0.02      0.00
mean     -0.07     -0.01     -0.02      0.05     -0.01      0.01      0.11
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.02     -0.17      0.25      0.07      0.00
5        -0.07     -0.14     -0.15      0.01      0.01
10        0.00      0.00      0.00      0.00      0.00
mean     -0.02     -0.10      0.03      0.03      0.00

, , b_1_4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.12      0.02      0.03     -0.10      0.01     -0.01      0.12
5        -0.13      0.00     -0.01      0.14     -0.01     -0.04     -0.30
10        0.00      0.00      0.00     -0.01      0.00      0.01      0.00
mean      0.00      0.01      0.01      0.01      0.00     -0.01     -0.06
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1        -0.03      0.01      0.05     -0.09     -0.16
5         0.04      0.07      0.46     -0.06     -0.10
10        0.00      0.00      0.00      0.00      0.00
mean      0.00      0.03      0.17     -0.05     -0.09

, , b_2_0

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.01     -0.15     -0.02      0.04     -0.14     -0.01     -0.04
5         0.03      0.14      0.01     -0.01     -0.05      0.00      0.05
10        0.00      0.22      0.01      0.00      0.13      0.01      0.00
mean      0.01      0.07      0.00      0.01     -0.02      0.00      0.00
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.35      0.03      0.01      0.33      0.03
5        -0.08      0.00     -0.05     -0.08      0.01
10       -0.23     -0.02      0.00     -0.30     -0.02
mean      0.01      0.00     -0.01     -0.02      0.01

, , b_2_1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.03      0.10      0.01      0.00      0.00         0      0.00
5        -0.04      0.40      0.04     -0.01     -0.05         0      0.05
10        0.00      0.35      0.02      0.00      0.00         0      0.00
mean     -0.02      0.28      0.02      0.00     -0.02         0      0.02
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.00         0      0.00      0.00      0.00
5        -0.08         0     -0.05     -0.08      0.01
10        0.00         0      0.00      0.00      0.00
mean     -0.03         0     -0.02     -0.03      0.00

, , b_2_2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.01     -0.15     -0.02     -0.02      0.26      0.03     -0.04
5         0.00      0.00      0.00     -0.06      0.35      0.03      0.00
10        0.00      0.00      0.00      0.00      0.26      0.03      0.00
mean      0.00     -0.05     -0.01     -0.03      0.29      0.03     -0.01
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.35      0.03      0.01      0.33      0.03
5         0.00      0.00      0.00      0.00      0.00
10        0.00      0.00      0.00      0.00      0.00
mean      0.12      0.01      0.00      0.11      0.01

, , b_2_3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.01      0.16      0.02     -0.04      0.15      0.01      0.03
5        -0.02     -0.09     -0.01      0.01      0.03      0.00     -0.07
10        0.00      0.28      0.01      0.00      0.17      0.02      0.00
mean      0.00      0.12      0.01     -0.01      0.12      0.01     -0.01
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1        -0.12     -0.01     -0.01     -0.35     -0.03
5         0.45      0.04      0.03      0.05     -0.01
10       -0.16     -0.01      0.00     -0.38     -0.02
mean      0.06      0.01      0.01     -0.23     -0.02

, , b_2_4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.00     -0.07     -0.01      0.02     -0.06     -0.01     -0.02
5         0.03      0.12      0.01     -0.01     -0.04      0.00      0.04
10        0.00     -0.08      0.00      0.00     -0.05      0.00      0.00
mean      0.01     -0.01      0.00      0.00     -0.05      0.00      0.01
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.15      0.01     -0.01      0.40      0.04
5        -0.07      0.00     -0.08      0.33      0.04
10        0.09      0.01      0.00      0.24      0.02
mean      0.06      0.01     -0.03      0.32      0.04

, , b_3_0

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.10     -0.02     -0.17      0.06     -0.01      0.03     -0.08
5         0.01      0.02      0.18     -0.06      0.01      0.02      0.12
10        0.00      0.01      0.12      0.00      0.01      0.15      0.00
mean     -0.03      0.01      0.05      0.00      0.00      0.07      0.01
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.03     -0.01      0.08      0.02     -0.03
5        -0.03     -0.10     -0.04     -0.02     -0.14
10       -0.01     -0.23      0.00     -0.01     -0.25
mean      0.00     -0.12      0.01      0.00     -0.14

, , b_3_1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.15      0.01      0.26      0.00      0.00      0.00      0.00
5        -0.07      0.03      0.40     -0.06      0.01      0.02      0.12
10        0.00      0.01      0.31      0.00      0.00      0.00      0.00
mean     -0.07      0.02      0.32     -0.02      0.00      0.01      0.04
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.00      0.00      0.00      0.00      0.00
5        -0.03     -0.10     -0.04     -0.02     -0.14
10        0.00      0.00      0.00      0.00      0.00
mean     -0.01     -0.03     -0.01     -0.01     -0.05

, , b_3_2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.10     -0.02     -0.17     -0.05      0.03      0.43     -0.08
5         0.00      0.00      0.00     -0.13      0.04      0.42      0.00
10        0.00      0.00      0.00      0.00      0.01      0.34      0.00
mean     -0.03     -0.01     -0.06     -0.06      0.03      0.40     -0.03
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.03     -0.02      0.08      0.02     -0.03
5         0.00      0.00      0.00      0.00      0.00
10        0.00      0.00      0.00      0.00      0.00
mean      0.01     -0.01      0.03      0.01     -0.01

, , b_3_3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.11      0.02      0.18     -0.06      0.01     -0.03      0.04
5        -0.01     -0.01     -0.11      0.04      0.00     -0.01     -0.14
10        0.00      0.01      0.16     -0.01      0.01      0.19      0.00
mean      0.04      0.01      0.07     -0.01      0.01      0.05     -0.03
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1        -0.01      0.45     -0.09     -0.02      0.04
5         0.05      0.46      0.03      0.01      0.09
10       -0.01     -0.10      0.00     -0.02     -0.31
mean      0.01      0.27     -0.02     -0.01     -0.06

, , b_3_4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.04     -0.01     -0.07      0.02      0.00      0.01     -0.03
5         0.01      0.02      0.15     -0.05      0.01      0.02      0.10
10        0.00      0.00     -0.05      0.00      0.00     -0.06      0.00
mean     -0.01      0.00      0.01     -0.01      0.00     -0.01      0.02
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.01     -0.01     -0.01      0.04      0.42
5        -0.02     -0.08     -0.10      0.02      0.28
10        0.00      0.09      0.00      0.01      0.28
mean      0.00      0.00     -0.04      0.02      0.33

, , R_1_2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.01     -0.47     -0.02     -0.24      0.04      0.05      0.19
5        -0.39     -0.13      0.01     -0.03      0.20      0.04     -0.14
10        0.00      0.00      0.00      0.03      0.01     -0.02     -0.01
mean     -0.13     -0.20      0.00     -0.08      0.08      0.02      0.01
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.46     -0.04      0.00      0.96      0.02
5        -0.30     -0.03      0.51      0.11     -0.07
10        0.00      0.01      0.01      0.00      0.00
mean      0.05     -0.02      0.17      0.36     -0.02

, , R_1_3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.68     -0.04     -0.75     -0.15      0.01      0.39      0.22
5         0.11     -0.03     -0.13      0.25      0.00      0.25     -0.44
10        0.00      0.00      0.00      0.02      0.00      0.01      0.00
mean      0.26     -0.02     -0.30      0.04      0.00      0.22     -0.08
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.01     -0.52     -0.39      0.09      0.45
5         0.02     -0.31     -0.03      0.04      0.18
10        0.00      0.00      0.00      0.00      0.00
mean      0.01     -0.28     -0.14      0.04      0.21

, , R_2_3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.03     -0.03     -0.08      0.09     -0.04     -0.12     -0.10
5         0.05      0.18      0.04     -0.04      0.05     -0.14      0.11
10        0.00      0.11      0.00     -0.01      0.09      0.13      0.00
mean      0.01      0.08     -0.02      0.01      0.03     -0.05      0.00
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.17      0.20      0.04      0.01      0.17
5        -0.20      0.24     -0.12     -0.32      0.23
10       -0.08     -0.25      0.00     -0.10     -0.22
mean     -0.04      0.07     -0.03     -0.14      0.06

> round( drop( attr( margEffCondM, "jacobian" )[ 4, , ] ), 2 )
          b_1_0 b_1_1 b_1_2 b_1_3 b_1_4 b_2_0 b_2_1 b_2_2 b_2_3 b_2_4 b_3_0
d_y1_d_x1  0.04  0.23  0.09 -0.07  0.00  0.01 -0.02  0.00  0.00  0.01 -0.03
d_y2_d_x1  0.01 -0.02  0.01 -0.01  0.01  0.07  0.28 -0.05  0.12 -0.01  0.01
d_y3_d_x1  0.02 -0.05  0.03 -0.02  0.01  0.00  0.02 -0.01  0.01  0.00  0.05
d_y1_d_x2 -0.01  0.06  0.20  0.05  0.01  0.01  0.00 -0.03 -0.01  0.00  0.00
d_y2_d_x2  0.00 -0.01 -0.04 -0.01  0.00 -0.02 -0.02  0.29  0.12 -0.05  0.00
d_y3_d_x2 -0.03 -0.01 -0.10  0.01 -0.01  0.00  0.00  0.03  0.01  0.00  0.07
d_y1_d_x3 -0.03 -0.12  0.09  0.11 -0.06  0.00  0.02 -0.01 -0.01  0.01  0.01
d_y2_d_x3 -0.01  0.02 -0.02 -0.02  0.00  0.01 -0.03  0.12  0.06  0.06  0.00
d_y3_d_x3  0.04  0.03  0.00 -0.10  0.03  0.00  0.00  0.01  0.01  0.01 -0.12
d_y1_d_x4  0.00  0.08 -0.08  0.03  0.17 -0.01 -0.02  0.00  0.01 -0.03  0.01
d_y2_d_x4 -0.03 -0.01 -0.02  0.03 -0.05 -0.02 -0.03  0.11 -0.23  0.32  0.00
d_y3_d_x4 -0.01 -0.01  0.00  0.00 -0.09  0.01  0.00  0.01 -0.02  0.04 -0.14
          b_3_1 b_3_2 b_3_3 b_3_4 R_1_2 R_1_3 R_2_3
d_y1_d_x1 -0.07 -0.03  0.04 -0.01 -0.13  0.26  0.01
d_y2_d_x1  0.02 -0.01  0.01  0.00 -0.20 -0.02  0.08
d_y3_d_x1  0.32 -0.06  0.07  0.01  0.00 -0.30 -0.02
d_y1_d_x2 -0.02 -0.06 -0.01 -0.01 -0.08  0.04  0.01
d_y2_d_x2  0.00  0.03  0.01  0.00  0.08  0.00  0.03
d_y3_d_x2  0.01  0.40  0.05 -0.01  0.02  0.22 -0.05
d_y1_d_x3  0.04 -0.03 -0.03  0.02  0.01 -0.08  0.00
d_y2_d_x3 -0.01  0.01  0.01  0.00  0.05  0.01 -0.04
d_y3_d_x3 -0.03 -0.01  0.27  0.00 -0.02 -0.28  0.07
d_y1_d_x4 -0.01  0.03 -0.02 -0.04  0.17 -0.14 -0.03
d_y2_d_x4 -0.01  0.01 -0.01  0.02  0.36  0.04 -0.14
d_y3_d_x4 -0.05 -0.01 -0.06  0.33 -0.02  0.21  0.06
> all.equal( summary( margEffCondV )[ , ], summary( margEffCondM )[ 1:36, ],
+    check.attributes = FALSE ) 
[1] TRUE
> print( summary( margEffCondM ), digits = c( 3, 3, 2, 2, 2 ) )
                Estimate Std. error z value Pr(> z)  
1: d_y1_d_x1       0.412      0.990    0.42    0.68  
1: d_y2_d_x1       0.118      0.570    0.21    0.84  
1: d_y3_d_x1      -0.360      0.870   -0.41    0.68  
1: d_y1_d_x2      -0.229      0.490   -0.46    0.64  
1: d_y2_d_x2       0.246      0.350    0.71    0.48  
1: d_y3_d_x2      -0.126      0.620   -0.20    0.84  
1: d_y1_d_x3       0.177      0.550    0.32    0.75  
1: d_y2_d_x3      -0.352      0.730   -0.48    0.63  
1: d_y3_d_x3       0.223      0.740    0.30    0.76  
1: d_y1_d_x4      -0.147      0.590   -0.25    0.80  
1: d_y2_d_x4      -0.329      1.210   -0.27    0.79  
1: d_y3_d_x4       0.604      0.660    0.91    0.36  
2: d_y1_d_x1       0.439      0.540    0.81    0.42  
2: d_y2_d_x1       0.271      0.510    0.53    0.59  
2: d_y3_d_x1      -0.262      0.510   -0.51    0.61  
2: d_y1_d_x2      -0.321      0.620   -0.52    0.60  
2: d_y2_d_x2       0.263      0.430    0.62    0.54  
2: d_y3_d_x2      -0.163      0.540   -0.30    0.76  
2: d_y1_d_x3       0.330      0.940    0.35    0.73  
2: d_y2_d_x3      -0.505      0.610   -0.83    0.40  
2: d_y3_d_x3       0.279      0.670    0.42    0.67  
2: d_y1_d_x4      -0.224      0.810   -0.28    0.78  
2: d_y2_d_x4      -0.568      0.500   -1.14    0.26  
2: d_y3_d_x4       0.488      0.480    1.02    0.31  
3: d_y1_d_x1       0.000      0.000    0.07    0.94  
3: d_y2_d_x1       0.232      0.510    0.45    0.65  
3: d_y3_d_x1      -0.130      0.370   -0.35    0.73  
3: d_y1_d_x2      -0.006      0.050   -0.10    0.92  
3: d_y2_d_x2       0.111      0.350    0.32    0.75  
3: d_y3_d_x2      -0.166      0.440   -0.38    0.71  
3: d_y1_d_x3       0.001      0.010    0.08    0.94  
3: d_y2_d_x3      -0.149      0.300   -0.50    0.62  
3: d_y3_d_x3       0.185      0.370    0.51    0.61  
3: d_y1_d_x4      -0.001      0.010   -0.07    0.94  
3: d_y2_d_x4      -0.199      0.550   -0.36    0.72  
3: d_y3_d_x4       0.199      0.530    0.37    0.71  
mean: d_y1_d_x1    0.284      0.400    0.70    0.48  
mean: d_y2_d_x1    0.207      0.390    0.53    0.60  
mean: d_y3_d_x1   -0.251      0.460   -0.55    0.58  
mean: d_y1_d_x2   -0.185      0.240   -0.76    0.45  
mean: d_y2_d_x2    0.207      0.330    0.62    0.53  
mean: d_y3_d_x2   -0.152      0.480   -0.32    0.75  
mean: d_y1_d_x3    0.169      0.230    0.75    0.45  
mean: d_y2_d_x3   -0.335      0.160   -2.05    0.04 *
mean: d_y3_d_x3    0.229      0.430    0.54    0.59  
mean: d_y1_d_x4   -0.124      0.310   -0.40    0.69  
mean: d_y2_d_x4   -0.365      0.570   -0.64    0.52  
mean: d_y3_d_x4    0.431      0.440    0.99    0.32  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
> 
> # for testing state of random number generator
> rnorm( 4 )
[1] -0.6467  0.2789  0.1209 -1.2689
> 
> # calculating marginal effects, conditional
> # (assuming that all other dependent variables are as observed)
> margEffCondObs <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ), 
+    cond = TRUE, algorithm = GenzBretz() )
> round( margEffCondObs, 3 )
   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.172     0.205    -0.127    -0.096     0.223    -0.175     0.049
2      0.453     0.185    -0.104    -0.371     0.266    -0.085     0.518
3      0.097     0.343    -0.206    -0.277     0.230    -0.128     0.241
4      0.182     0.223    -0.356    -0.349     0.246    -0.156     0.379
5      0.396     0.265    -0.224    -0.323     0.252    -0.134     0.539
6      0.024     0.145    -0.073    -0.133     0.070    -0.062     0.078
7      0.248     0.145    -0.144    -0.026     0.113    -0.125     0.086
8      0.105     0.350    -0.238    -0.283     0.240    -0.148     0.252
9      0.305     0.030    -0.025    -0.211     0.083    -0.052     0.152
10     0.001     0.232    -0.116    -0.019     0.111    -0.138     0.006
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.385     0.244    -0.036    -0.504     0.302
2     -0.426     0.132    -0.342    -0.468     0.274
3     -0.358     0.193    -0.170    -0.436     0.303
4     -0.373     0.244    -0.264    -0.356     0.567
5     -0.524     0.232    -0.395    -0.539     0.456
6     -0.076     0.065    -0.053    -0.098     0.085
7     -0.310     0.253    -0.066    -0.399     0.333
8     -0.386     0.237    -0.185    -0.467     0.378
9     -0.089     0.057    -0.100    -0.113     0.082
10    -0.149     0.148    -0.005    -0.199     0.166
> margEffCondObsA <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) ), 
+    cond = TRUE, algorithm = GenzBretz() )
> all.equal( margEffCondObs, margEffCondObsA )
[1] TRUE
> # now with integrals obtained by the Miwa algorithm, reduced precision
> margEffCondObs1 <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE, algorithm = Miwa( steps = 32 ) )
> round( margEffCondObs1, 3 )
   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.172     0.205    -0.127    -0.096     0.223    -0.175     0.049
2      0.453     0.185    -0.104    -0.371     0.266    -0.085     0.518
3      0.097     0.343    -0.206    -0.277     0.230    -0.128     0.241
4      0.182     0.223    -0.356    -0.349     0.246    -0.156     0.379
5      0.396     0.265    -0.224    -0.323     0.252    -0.134     0.539
6      0.024     0.145    -0.073    -0.133     0.070    -0.062     0.078
7      0.248     0.145    -0.144    -0.026     0.113    -0.125     0.086
8      0.105     0.350    -0.238    -0.283     0.240    -0.148     0.252
9      0.305     0.030    -0.025    -0.211     0.083    -0.052     0.152
10     0.001     0.232    -0.116    -0.019     0.111    -0.138     0.006
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.385     0.244    -0.036    -0.504     0.302
2     -0.426     0.132    -0.342    -0.468     0.274
3     -0.358     0.193    -0.170    -0.436     0.303
4     -0.373     0.244    -0.264    -0.356     0.568
5     -0.524     0.232    -0.395    -0.539     0.455
6     -0.076     0.065    -0.053    -0.098     0.085
7     -0.310     0.253    -0.065    -0.399     0.333
8     -0.386     0.237    -0.185    -0.467     0.379
9     -0.089     0.057    -0.100    -0.113     0.082
10    -0.149     0.148    -0.005    -0.199     0.166
> all.equal( margEffCondObs, margEffCondObs1, tol = 1e-3 )
[1] TRUE
> # now with integrals obtained by the GHK algorithm
> margEffCondObs2 <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, data = as.data.frame( cbind( xMat, yMat ) ),
+    cond = TRUE )
> round( margEffCondObs2, 3 )
   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      0.172     0.205    -0.127    -0.096     0.223    -0.175     0.049
2      0.453     0.185    -0.104    -0.371     0.266    -0.085     0.518
3      0.097     0.343    -0.206    -0.277     0.230    -0.128     0.241
4      0.182     0.223    -0.356    -0.349     0.247    -0.156     0.379
5      0.396     0.265    -0.224    -0.323     0.252    -0.134     0.539
6      0.024     0.145    -0.073    -0.133     0.070    -0.062     0.078
7      0.248     0.145    -0.144    -0.026     0.113    -0.125     0.086
8      0.105     0.350    -0.238    -0.283     0.240    -0.148     0.252
9      0.305     0.029    -0.025    -0.211     0.083    -0.052     0.152
10     0.001     0.232    -0.116    -0.019     0.111    -0.138     0.006
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1     -0.385     0.244    -0.036    -0.504     0.302
2     -0.425     0.132    -0.342    -0.468     0.274
3     -0.358     0.193    -0.170    -0.435     0.303
4     -0.374     0.244    -0.264    -0.356     0.568
5     -0.524     0.232    -0.395    -0.539     0.456
6     -0.076     0.065    -0.053    -0.098     0.085
7     -0.310     0.253    -0.065    -0.399     0.333
8     -0.386     0.237    -0.185    -0.467     0.379
9     -0.089     0.058    -0.100    -0.113     0.083
10    -0.149     0.148    -0.005    -0.199     0.166
> all.equal( margEffCondObs, margEffCondObs2, tol = 1e-3 )
[1] TRUE
> all.equal( margEffCondObs1, margEffCondObs2, tol = 1e-3 )
[1] TRUE
> # now with variance covariance matrix and Jacobian
> margEffCondObsV <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, 
+    data = as.data.frame( cbind( xMat, yMat ) )[ c(1,5,10), ], 
+    cond = TRUE, vcov = diag( 18 ), returnJacobian = TRUE,
+    algorithm = GenzBretz() )
> round( attr( margEffCondObsV, "vcov" ), 2 )
, , d_y1_d_x1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.27      0.00      0.00     -0.09      0.01      0.02      0.09
5       0.48      0.07     -0.19     -0.24      0.01     -0.19     -0.11
10      0.00      0.00      0.00      0.00      0.00      0.00      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      -0.02     -0.05     -0.06     -0.01     -0.03
5       0.11      0.33      0.04     -0.24      0.14
10      0.00      0.00      0.00      0.00      0.00

, , d_y2_d_x1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.00      0.17      0.00     -0.01     -0.02     -0.02      0.01
5       0.07      0.34     -0.02     -0.02     -0.07     -0.14     -0.09
10      0.00      0.26      0.01      0.00      0.09      0.00      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      -0.12      0.01      0.00     -0.28      0.00
5       0.08      0.18     -0.04     -0.15      0.09
10     -0.11      0.00      0.00     -0.20     -0.01

, , d_y3_d_x1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.00      0.00      0.11     -0.02     -0.01      0.02      0.02
5      -0.19     -0.02      0.31      0.10     -0.06      0.13      0.03
10      0.00      0.01      0.14      0.00      0.00      0.07      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.01     -0.11     -0.01      0.00     -0.21
5       0.03     -0.30     -0.02      0.18     -0.28
10      0.00     -0.06      0.00      0.00     -0.11

, , d_y1_d_x2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.09     -0.01     -0.02      0.11     -0.02     -0.03     -0.06
5      -0.24     -0.02      0.10      0.23     -0.05      0.06     -0.01
10      0.00      0.00      0.00      0.01      0.00     -0.01      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.01      0.02      0.03      0.02      0.04
5      -0.02     -0.22     -0.16      0.11     -0.04
10      0.00      0.01      0.00      0.00      0.01

, , d_y2_d_x2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.01     -0.02     -0.01     -0.02      0.15     -0.01      0.01
5       0.01     -0.07     -0.06     -0.05      0.19      0.00      0.03
10      0.00      0.09      0.00      0.00      0.12      0.01      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.03      0.04      0.00      0.00      0.04
5      -0.09      0.08      0.04     -0.11      0.10
10     -0.07      0.00      0.00     -0.12      0.00

, , d_y3_d_x2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.02     -0.02      0.02     -0.03     -0.01      0.17      0.00
5      -0.19     -0.14      0.13      0.06      0.00      0.43      0.02
10      0.00      0.00      0.07     -0.01      0.01      0.16      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.04     -0.05       0.0      0.04     -0.09
5      -0.02     -0.34      -0.1      0.25     -0.15
10      0.00     -0.07       0.0     -0.01     -0.12

, , d_y1_d_x3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.09      0.01      0.02     -0.06      0.01      0.00      0.05
5      -0.11     -0.09      0.03     -0.01      0.03      0.02      0.35
10      0.00      0.00      0.00      0.00      0.00      0.00      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      -0.02     -0.03     -0.03     -0.01     -0.03
5      -0.17     -0.12      0.24      0.12     -0.10
10      0.00      0.00      0.00      0.00      0.00

, , d_y2_d_x3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.02     -0.12      0.01      0.01      0.03      0.04     -0.02
5       0.11      0.08      0.03     -0.02     -0.09     -0.02     -0.17
10      0.00     -0.11      0.00      0.00     -0.07      0.00      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.19     -0.03      0.01      0.24     -0.04
5       0.34      0.04     -0.10      0.01     -0.08
10      0.09      0.00      0.00      0.16      0.00

, , d_y3_d_x3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.05      0.01     -0.11      0.02      0.04     -0.05     -0.03
5       0.33      0.18     -0.30     -0.22      0.08     -0.34     -0.12
10      0.00      0.00     -0.06      0.01      0.00     -0.07      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      -0.03      0.22      0.01     -0.03      0.27
5       0.04      0.71      0.14     -0.39      0.34
10      0.00      0.08      0.00      0.01      0.12

, , d_y1_d_x4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.06      0.00     -0.01      0.03      0.00       0.0     -0.03
5       0.04     -0.04     -0.02     -0.16      0.04      -0.1      0.24
10      0.00      0.00      0.00      0.00      0.00       0.0      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.01      0.01      0.02      0.00      0.01
5      -0.10      0.14      0.54     -0.01     -0.14
10      0.00      0.00      0.00      0.00      0.00

, , d_y2_d_x4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.01     -0.28      0.00      0.02      0.00      0.04     -0.01
5      -0.24     -0.15      0.18      0.11     -0.11      0.25      0.12
10      0.00     -0.20      0.00      0.00     -0.12     -0.01      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.24     -0.03      0.00      0.60     -0.02
5       0.01     -0.39     -0.01      0.56     -0.26
10      0.16      0.01      0.00      0.30      0.01

, , d_y3_d_x4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.03      0.00     -0.21      0.04      0.04     -0.09     -0.03
5       0.14      0.09     -0.28     -0.04      0.10     -0.15     -0.10
10      0.00     -0.01     -0.11      0.01      0.00     -0.12      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      -0.04      0.27      0.01     -0.02      0.52
5      -0.08      0.34     -0.14     -0.26      0.48
10      0.00      0.12      0.00      0.01      0.21

> round( drop( attr( margEffCondObsV, "vcov" )[ 1, , ] ), 2 )
          d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
d_y1_d_x1      0.27      0.00      0.00     -0.09      0.01      0.02      0.09
d_y2_d_x1      0.00      0.17      0.00     -0.01     -0.02     -0.02      0.01
d_y3_d_x1      0.00      0.00      0.11     -0.02     -0.01      0.02      0.02
d_y1_d_x2     -0.09     -0.01     -0.02      0.11     -0.02     -0.03     -0.06
d_y2_d_x2      0.01     -0.02     -0.01     -0.02      0.15     -0.01      0.01
d_y3_d_x2      0.02     -0.02      0.02     -0.03     -0.01      0.17      0.00
d_y1_d_x3      0.09      0.01      0.02     -0.06      0.01      0.00      0.05
d_y2_d_x3     -0.02     -0.12      0.01      0.01      0.03      0.04     -0.02
d_y3_d_x3     -0.05      0.01     -0.11      0.02      0.04     -0.05     -0.03
d_y1_d_x4     -0.06      0.00     -0.01      0.03      0.00      0.00     -0.03
d_y2_d_x4     -0.01     -0.28      0.00      0.02      0.00      0.04     -0.01
d_y3_d_x4     -0.03      0.00     -0.21      0.04      0.04     -0.09     -0.03
          d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
d_y1_d_x1     -0.02     -0.05     -0.06     -0.01     -0.03
d_y2_d_x1     -0.12      0.01      0.00     -0.28      0.00
d_y3_d_x1      0.01     -0.11     -0.01      0.00     -0.21
d_y1_d_x2      0.01      0.02      0.03      0.02      0.04
d_y2_d_x2      0.03      0.04      0.00      0.00      0.04
d_y3_d_x2      0.04     -0.05      0.00      0.04     -0.09
d_y1_d_x3     -0.02     -0.03     -0.03     -0.01     -0.03
d_y2_d_x3      0.19     -0.03      0.01      0.24     -0.04
d_y3_d_x3     -0.03      0.22      0.01     -0.03      0.27
d_y1_d_x4      0.01      0.01      0.02      0.00      0.01
d_y2_d_x4      0.24     -0.03      0.00      0.60     -0.02
d_y3_d_x4     -0.04      0.27      0.01     -0.02      0.52
> round( attr( margEffCondObsV, "jacobian" ), 2 )
, , b_1_0

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.24      0.00      0.00     -0.16      0.02      0.05      0.12
5       0.28      0.01     -0.04     -0.18      0.01     -0.05      0.05
10      0.00      0.00      0.00      0.05      0.00     -0.02     -0.02
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      -0.02     -0.05     -0.08      0.00      0.00
5       0.02      0.09     -0.03     -0.04      0.03
10      0.00      0.01      0.01      0.00      0.00

, , b_1_1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.28     -0.01     -0.02      0.00      0.00      0.00      0.00
5       0.43     -0.06     -0.09     -0.18      0.01     -0.05      0.05
10      0.00      0.00      0.00      0.00      0.00      0.00      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.00      0.00      0.00      0.00      0.00
5       0.02      0.09     -0.03     -0.04      0.03
10      0.00      0.00      0.00      0.00      0.00

, , b_1_2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.24         0         0      0.04      0.00     -0.02      0.12
5       0.00         0         0      0.25     -0.06     -0.14      0.00
10      0.00         0         0      0.05      0.00     -0.02      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      -0.02     -0.05     -0.08         0         0
5       0.00      0.00      0.00         0         0
10      0.00      0.00      0.00         0         0

, , b_1_3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.25      0.00      0.00      0.17     -0.02     -0.06     -0.08
5      -0.17     -0.01      0.03      0.11      0.00      0.03      0.40
10     -0.01      0.00      0.00      0.06     -0.01     -0.03     -0.02
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.01      0.04      0.09      0.00      0.00
5      -0.08     -0.15      0.02      0.03     -0.02
10      0.00      0.01      0.02      0.00      0.00

, , b_1_4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.10      0.00      0.00     -0.07      0.01      0.02      0.05
5       0.23      0.01     -0.04     -0.15      0.01     -0.04      0.04
10      0.00      0.00      0.00     -0.02      0.00      0.01      0.01
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      -0.01     -0.02      0.00       0.0     -0.02
5       0.02      0.08      0.41      -0.1     -0.06
10      0.00      0.00      0.00       0.0      0.00

, , b_2_0

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.01     -0.21     -0.01      0.02     -0.07     -0.02     -0.01
5      -0.05      0.06      0.02      0.02     -0.11      0.02      0.02
10      0.00      0.22      0.01      0.00      0.13      0.01      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.24      0.03      0.00      0.32      0.03
5       0.05     -0.04      0.03      0.06     -0.04
10     -0.23     -0.01      0.00     -0.30     -0.01

, , b_2_1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.01      0.12      0.00      0.00      0.00      0.00      0.00
5      -0.06      0.41      0.03      0.02     -0.11      0.02      0.02
10      0.00      0.35      0.01      0.00      0.00      0.00      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.00      0.00      0.00      0.00      0.00
5       0.05     -0.04      0.03      0.06     -0.04
10      0.00      0.00      0.00      0.00      0.00

, , b_2_2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.01     -0.21     -0.01      0.00      0.33      0.01     -0.01
5       0.00      0.00      0.00     -0.04      0.29      0.05      0.00
10      0.00      0.00      0.00      0.00      0.26      0.01      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.24      0.03         0      0.32      0.03
5       0.00      0.00         0      0.00      0.00
10      0.00      0.00         0      0.00      0.00

, , b_2_3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.01      0.22      0.01     -0.03      0.08      0.02      0.01
5       0.03     -0.04     -0.02     -0.01      0.07     -0.01     -0.07
10      0.00      0.28      0.01      0.00      0.17      0.01      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.07     -0.01      0.00     -0.34     -0.03
5       0.37      0.06     -0.02     -0.04      0.02
10     -0.16     -0.01      0.00     -0.38     -0.02

, , b_2_4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.00     -0.09      0.00      0.01     -0.03     -0.01     -0.01
5      -0.04      0.05      0.02      0.02     -0.09      0.02      0.02
10      0.00     -0.08      0.00      0.00     -0.05      0.00      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.10      0.01      0.00      0.46      0.03
5       0.04     -0.03     -0.04      0.46      0.00
10      0.09      0.00      0.00      0.24      0.01

, , b_3_0

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.02     -0.01     -0.16      0.05     -0.02     -0.13     -0.03
5      -0.07     -0.01      0.22      0.06     -0.01      0.06     -0.04
10      0.00      0.01      0.13     -0.01      0.01      0.15      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.02      0.24      0.01      0.02      0.29
5       0.00     -0.15     -0.03      0.03     -0.26
10     -0.01     -0.22      0.00     -0.01     -0.24

, , b_3_1

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.03      0.00      0.10      0.00      0.00      0.00      0.00
5      -0.12      0.05      0.37      0.06     -0.01      0.06     -0.04
10      0.00      0.01      0.27      0.00      0.00      0.00      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1          0      0.00      0.00      0.00      0.00
5          0     -0.15     -0.03      0.03     -0.26
10         0      0.00      0.00      0.00      0.00

, , b_3_2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.02     -0.01     -0.16     -0.01      0.01      0.26     -0.03
5       0.00      0.00      0.00     -0.06      0.04      0.42      0.00
10      0.00      0.00      0.00     -0.01      0.01      0.30      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.02      0.24      0.01      0.02      0.29
5       0.00      0.00      0.00      0.00      0.00
10      0.00      0.00      0.00      0.00      0.00

, , b_3_3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.02      0.01      0.17     -0.05      0.02      0.13      0.02
5       0.05      0.00     -0.14     -0.04      0.01     -0.04     -0.10
10      0.00      0.01      0.16     -0.01      0.01      0.19      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      -0.01      0.00     -0.01     -0.03     -0.30
5       0.05      0.46      0.02     -0.02      0.16
10     -0.01     -0.13      0.00     -0.02     -0.30

, , b_3_4

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.01      0.00     -0.07      0.02     -0.01     -0.05     -0.01
5      -0.06     -0.01      0.18      0.05     -0.01      0.05     -0.03
10      0.00      0.00     -0.05      0.00      0.00     -0.06      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.01      0.10      0.00      0.02      0.38
5       0.00     -0.12     -0.15      0.08      0.16
10      0.00      0.08      0.00      0.01      0.23

, , R_1_2

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.01     -0.02      0.00     -0.11      0.06      0.06      0.04
5      -0.26     -0.31      0.05      0.00      0.14      0.17      0.36
10      0.00      0.00      0.00     -0.01      0.01      0.01      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      -0.03     -0.03      0.00      0.01     -0.01
5      -0.35     -0.20      0.37      0.29     -0.11
10      0.00      0.00      0.00      0.00      0.00

, , R_1_3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1      -0.03      0.00     -0.05      0.17     -0.01      0.12     -0.11
5      -0.14     -0.15     -0.01      0.22      0.00      0.33     -0.17
10      0.00      0.00      0.00      0.04      0.00      0.03     -0.01
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       0.01     -0.08      0.02      0.00      0.03
5      -0.03     -0.40     -0.45      0.17      0.09
10      0.00     -0.01      0.00      0.00      0.00

, , R_2_3

   d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1       0.00      0.10     -0.11      0.01      0.14     -0.20     -0.01
5       0.11      0.19     -0.24     -0.05      0.20     -0.26     -0.06
10      0.00      0.11     -0.13      0.00      0.09     -0.08      0.00
   d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1      -0.22      0.28      0.00     -0.26      0.34
5      -0.24      0.43     -0.06     -0.46      0.52
10     -0.08      0.08      0.00     -0.10      0.10

> round( drop( attr( margEffCondObsV, "jacobian" )[ 1, , ] ), 2 )
          b_1_0 b_1_1 b_1_2 b_1_3 b_1_4 b_2_0 b_2_1 b_2_2 b_2_3 b_2_4 b_3_0
d_y1_d_x1  0.24  0.28  0.24 -0.25  0.10 -0.01 -0.01 -0.01  0.01  0.00 -0.02
d_y2_d_x1  0.00 -0.01  0.00  0.00  0.00 -0.21  0.12 -0.21  0.22 -0.09 -0.01
d_y3_d_x1  0.00 -0.02  0.00  0.00  0.00 -0.01  0.00 -0.01  0.01  0.00 -0.16
d_y1_d_x2 -0.16  0.00  0.04  0.17 -0.07  0.02  0.00  0.00 -0.03  0.01  0.05
d_y2_d_x2  0.02  0.00  0.00 -0.02  0.01 -0.07  0.00  0.33  0.08 -0.03 -0.02
d_y3_d_x2  0.05  0.00 -0.02 -0.06  0.02 -0.02  0.00  0.01  0.02 -0.01 -0.13
d_y1_d_x3  0.12  0.00  0.12 -0.08  0.05 -0.01  0.00 -0.01  0.01 -0.01 -0.03
d_y2_d_x3 -0.02  0.00 -0.02  0.01 -0.01  0.24  0.00  0.24  0.07  0.10  0.02
d_y3_d_x3 -0.05  0.00 -0.05  0.04 -0.02  0.03  0.00  0.03 -0.01  0.01  0.24
d_y1_d_x4 -0.08  0.00 -0.08  0.09  0.00  0.00  0.00  0.00  0.00  0.00  0.01
d_y2_d_x4  0.00  0.00  0.00  0.00  0.00  0.32  0.00  0.32 -0.34  0.46  0.02
d_y3_d_x4  0.00  0.00  0.00  0.00 -0.02  0.03  0.00  0.03 -0.03  0.03  0.29
          b_3_1 b_3_2 b_3_3 b_3_4 R_1_2 R_1_3 R_2_3
d_y1_d_x1 -0.03 -0.02  0.02 -0.01  0.01 -0.03  0.00
d_y2_d_x1  0.00 -0.01  0.01  0.00 -0.02  0.00  0.10
d_y3_d_x1  0.10 -0.16  0.17 -0.07  0.00 -0.05 -0.11
d_y1_d_x2  0.00 -0.01 -0.05  0.02 -0.11  0.17  0.01
d_y2_d_x2  0.00  0.01  0.02 -0.01  0.06 -0.01  0.14
d_y3_d_x2  0.00  0.26  0.13 -0.05  0.06  0.12 -0.20
d_y1_d_x3  0.00 -0.03  0.02 -0.01  0.04 -0.11 -0.01
d_y2_d_x3  0.00  0.02 -0.01  0.01 -0.03  0.01 -0.22
d_y3_d_x3  0.00  0.24  0.00  0.10 -0.03 -0.08  0.28
d_y1_d_x4  0.00  0.01 -0.01  0.00  0.00  0.02  0.00
d_y2_d_x4  0.00  0.02 -0.03  0.02  0.01  0.00 -0.26
d_y3_d_x4  0.00  0.29 -0.30  0.38 -0.01  0.03  0.34
> print( summary( margEffCondObsV ), digits = c( 3, 3, 2, 2, 2 ) )
             Estimate Std. error z value Pr(> z)
1: d_y1_d_x1    0.172      0.520    0.33    0.74
1: d_y2_d_x1    0.205      0.410    0.50    0.62
1: d_y3_d_x1   -0.127      0.330   -0.38    0.70
1: d_y1_d_x2   -0.096      0.330   -0.29    0.77
1: d_y2_d_x2    0.223      0.380    0.58    0.56
1: d_y3_d_x2   -0.175      0.410   -0.42    0.67
1: d_y1_d_x3    0.049      0.230    0.22    0.83
1: d_y2_d_x3   -0.385      0.430   -0.89    0.37
1: d_y3_d_x3    0.244      0.470    0.52    0.60
1: d_y1_d_x4   -0.036      0.150   -0.24    0.81
1: d_y2_d_x4   -0.504      0.780   -0.65    0.52
1: d_y3_d_x4    0.302      0.720    0.42    0.68
2: d_y1_d_x1    0.396      0.690    0.57    0.57
2: d_y2_d_x1    0.265      0.580    0.46    0.65
2: d_y3_d_x1   -0.224      0.550   -0.40    0.69
2: d_y1_d_x2   -0.323      0.480   -0.67    0.50
2: d_y2_d_x2    0.252      0.430    0.58    0.56
2: d_y3_d_x2   -0.134      0.660   -0.20    0.84
2: d_y1_d_x3    0.539      0.590    0.91    0.36
2: d_y2_d_x3   -0.524      0.580   -0.90    0.37
2: d_y3_d_x3    0.232      0.840    0.28    0.78
2: d_y1_d_x4   -0.395      0.730   -0.54    0.59
2: d_y2_d_x4   -0.539      0.750   -0.72    0.47
2: d_y3_d_x4    0.456      0.690    0.66    0.51
3: d_y1_d_x1    0.001      0.010    0.16    0.87
3: d_y2_d_x1    0.232      0.510    0.45    0.65
3: d_y3_d_x1   -0.116      0.370   -0.31    0.75
3: d_y1_d_x2   -0.019      0.100   -0.18    0.86
3: d_y2_d_x2    0.111      0.350    0.32    0.75
3: d_y3_d_x2   -0.138      0.400   -0.34    0.73
3: d_y1_d_x3    0.006      0.030    0.19    0.85
3: d_y2_d_x3   -0.149      0.300   -0.50    0.62
3: d_y3_d_x3    0.148      0.280    0.53    0.59
3: d_y1_d_x4   -0.005      0.020   -0.20    0.84
3: d_y2_d_x4   -0.199      0.550   -0.36    0.72
3: d_y3_d_x4    0.166      0.460    0.36    0.72
> margEffCondObsVA <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = allCoef, data = as.data.frame( cbind( xMat, yMat ) )[ c(1,5,10), ], 
+    cond = TRUE, vcov = diag( 18 ), returnJacobian = TRUE,
+    algorithm = GenzBretz() )
> all.equal( margEffCondObs, margEffCondObsA )
[1] TRUE
> # now with Jacobian but without variance covariance matrix
> margEffCondObsJac <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, 
+    data = as.data.frame( cbind( xMat, yMat ) )[ c(1,5,10), ], 
+    cond = TRUE, returnJacobian = TRUE, algorithm = GenzBretz() )
> all.equal( attr( margEffCondObsJac, "jacobian" ), 
+    attr( margEffCondObsV, "jacobian" ) )
[1] TRUE
> # now with mean values of marginal effects
> margEffCondObsM <- mvProbitMargEff( cbind( y1, y2, y3 ) ~ x1 + x2 + x3 + x4, 
+    coef = c( beta ), sigma = sigma, 
+    data = as.data.frame( cbind( xMat, yMat ) )[ c(1,5,10), ], 
+    cond = TRUE, vcov = diag( 18 ), addMean = TRUE, returnJacobian = TRUE,
+    algorithm = GenzBretz() )
> all.equal( margEffCondObsV, margEffCondObsM[ 1:3, ], check.attributes = FALSE )
[1] TRUE
> round( margEffCondObsM, 3 )
     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        0.172     0.205    -0.127    -0.096     0.223    -0.175     0.049
2        0.396     0.265    -0.224    -0.323     0.252    -0.134     0.539
3        0.001     0.232    -0.116    -0.019     0.111    -0.138     0.006
mean     0.190     0.234    -0.156    -0.146     0.195    -0.149     0.198
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1       -0.385     0.244    -0.036    -0.504     0.302
2       -0.524     0.232    -0.395    -0.539     0.456
3       -0.149     0.148    -0.005    -0.199     0.166
mean    -0.353     0.208    -0.145    -0.414     0.308
> all.equal( attr( margEffCondObsV, "vcov" ), 
+    attr( margEffCondObsM, "vcov" )[ 1:3, , ] )
[1] TRUE
> round( attr( margEffCondObsM, "vcov" ), 2 )
, , d_y1_d_x1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.27      0.00      0.00     -0.09      0.01      0.02      0.09
5         0.48      0.07     -0.19     -0.24      0.01     -0.19     -0.11
10        0.00      0.00      0.00      0.00      0.00      0.00      0.00
mean      0.14      0.01     -0.03     -0.06      0.01     -0.03      0.00
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1        -0.02     -0.05     -0.06     -0.01     -0.03
5         0.11      0.33      0.04     -0.24      0.14
10        0.00      0.00      0.00      0.00      0.00
mean      0.01      0.05      0.00     -0.04      0.01

, , d_y2_d_x1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.00      0.17      0.00     -0.01     -0.02     -0.02      0.01
5         0.07      0.34     -0.02     -0.02     -0.07     -0.14     -0.09
10        0.00      0.26      0.01      0.00      0.09      0.00      0.00
mean      0.01      0.15     -0.01      0.00      0.00     -0.04     -0.01
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1        -0.12      0.01      0.00     -0.28      0.00
5         0.08      0.18     -0.04     -0.15      0.09
10       -0.11      0.00      0.00     -0.20     -0.01
mean      0.00      0.05     -0.01     -0.11      0.03

, , d_y3_d_x1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.00      0.00      0.11     -0.02     -0.01      0.02      0.02
5        -0.19     -0.02      0.31      0.10     -0.06      0.13      0.03
10        0.00      0.01      0.14      0.00      0.00      0.07      0.00
mean     -0.03     -0.01      0.10      0.01     -0.03      0.02      0.00
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.01     -0.11     -0.01      0.00     -0.21
5         0.03     -0.30     -0.02      0.18     -0.28
10        0.00     -0.06      0.00      0.00     -0.11
mean      0.03     -0.05      0.00      0.05     -0.09

, , d_y1_d_x2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.09     -0.01     -0.02      0.11     -0.02     -0.03     -0.06
5        -0.24     -0.02      0.10      0.23     -0.05      0.06     -0.01
10        0.00      0.00      0.00      0.01      0.00     -0.01      0.00
mean     -0.06      0.00      0.01      0.07     -0.02      0.00     -0.01
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.01      0.02      0.03      0.02      0.04
5        -0.02     -0.22     -0.16      0.11     -0.04
10        0.00      0.01      0.00      0.00      0.01
mean      0.00     -0.04     -0.03      0.02      0.01

, , d_y2_d_x2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.01     -0.02     -0.01     -0.02      0.15     -0.01      0.01
5         0.01     -0.07     -0.06     -0.05      0.19      0.00      0.03
10        0.00      0.09      0.00      0.00      0.12      0.01      0.00
mean      0.01      0.00     -0.03     -0.02      0.13      0.00      0.00
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.03      0.04      0.00      0.00      0.04
5        -0.09      0.08      0.04     -0.11      0.10
10       -0.07      0.00      0.00     -0.12      0.00
mean     -0.01      0.04      0.01     -0.05      0.04

, , d_y3_d_x2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.02     -0.02      0.02     -0.03     -0.01      0.17      0.00
5        -0.19     -0.14      0.13      0.06      0.00      0.43      0.02
10        0.00      0.00      0.07     -0.01      0.01      0.16      0.00
mean     -0.03     -0.04      0.02      0.00      0.00      0.19     -0.01
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.04     -0.05      0.00      0.04     -0.09
5        -0.02     -0.34     -0.10      0.25     -0.15
10        0.00     -0.07      0.00     -0.01     -0.12
mean      0.03     -0.05     -0.01      0.07     -0.05

, , d_y1_d_x3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.09      0.01      0.02     -0.06      0.01      0.00      0.05
5        -0.11     -0.09      0.03     -0.01      0.03      0.02      0.35
10        0.00      0.00      0.00      0.00      0.00      0.00      0.00
mean      0.00     -0.01      0.00     -0.01      0.00     -0.01      0.05
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1        -0.02     -0.03     -0.03     -0.01     -0.03
5        -0.17     -0.12      0.24      0.12     -0.10
10        0.00      0.00      0.00      0.00      0.00
mean     -0.02     -0.01      0.04      0.02     -0.02

, , d_y2_d_x3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.02     -0.12      0.01      0.01      0.03      0.04     -0.02
5         0.11      0.08      0.03     -0.02     -0.09     -0.02     -0.17
10        0.00     -0.11      0.00      0.00     -0.07      0.00      0.00
mean      0.01      0.00      0.03      0.00     -0.01      0.03     -0.02
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.19     -0.03      0.01      0.24     -0.04
5         0.34      0.04     -0.10      0.01     -0.08
10        0.09      0.00      0.00      0.16      0.00
mean      0.07     -0.03     -0.01      0.05     -0.05

, , d_y3_d_x3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.05      0.01     -0.11      0.02      0.04     -0.05     -0.03
5         0.33      0.18     -0.30     -0.22      0.08     -0.34     -0.12
10        0.00      0.00     -0.06      0.01      0.00     -0.07      0.00
mean      0.05      0.05     -0.05     -0.04      0.04     -0.05     -0.01
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1        -0.03      0.22      0.01     -0.03      0.27
5         0.04      0.71      0.14     -0.39      0.34
10        0.00      0.08      0.00      0.01      0.12
mean     -0.03      0.13      0.01     -0.10      0.08

, , d_y1_d_x4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.06      0.00     -0.01      0.03      0.00      0.00     -0.03
5         0.04     -0.04     -0.02     -0.16      0.04     -0.10      0.24
10        0.00      0.00      0.00      0.00      0.00      0.00      0.00
mean      0.00     -0.01      0.00     -0.03      0.01     -0.01      0.04
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.01      0.01      0.02      0.00      0.01
5        -0.10      0.14      0.54     -0.01     -0.14
10        0.00      0.00      0.00      0.00      0.00
mean     -0.01      0.01      0.06      0.00     -0.03

, , d_y2_d_x4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.01     -0.28      0.00      0.02      0.00      0.04     -0.01
5        -0.24     -0.15      0.18      0.11     -0.11      0.25      0.12
10        0.00     -0.20      0.00      0.00     -0.12     -0.01      0.00
mean     -0.04     -0.11      0.05      0.02     -0.05      0.07      0.02
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.24     -0.03      0.00      0.60     -0.02
5         0.01     -0.39     -0.01      0.56     -0.26
10        0.16      0.01      0.00      0.30      0.01
mean      0.05     -0.10      0.00      0.32     -0.07

, , d_y3_d_x4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.03      0.00     -0.21      0.04      0.04     -0.09     -0.03
5         0.14      0.09     -0.28     -0.04      0.10     -0.15     -0.10
10        0.00     -0.01     -0.11      0.01      0.00     -0.12      0.00
mean      0.01      0.03     -0.09      0.01      0.04     -0.05     -0.02
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1        -0.04      0.27      0.01     -0.02      0.52
5        -0.08      0.34     -0.14     -0.26      0.48
10        0.00      0.12      0.00      0.01      0.21
mean     -0.05      0.08     -0.03     -0.07      0.22

> round( drop( attr( margEffCondObsM, "vcov" )[ 4, , ] ), 2 )
          d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
d_y1_d_x1      0.14      0.01     -0.03     -0.06      0.01     -0.03      0.00
d_y2_d_x1      0.01      0.15     -0.01      0.00      0.00     -0.04     -0.01
d_y3_d_x1     -0.03     -0.01      0.10      0.01     -0.03      0.02      0.00
d_y1_d_x2     -0.06      0.00      0.01      0.07     -0.02      0.00     -0.01
d_y2_d_x2      0.01      0.00     -0.03     -0.02      0.13      0.00      0.00
d_y3_d_x2     -0.03     -0.04      0.02      0.00      0.00      0.19     -0.01
d_y1_d_x3      0.00     -0.01      0.00     -0.01      0.00     -0.01      0.05
d_y2_d_x3      0.01      0.00      0.03      0.00     -0.01      0.03     -0.02
d_y3_d_x3      0.05      0.05     -0.05     -0.04      0.04     -0.05     -0.01
d_y1_d_x4      0.00     -0.01      0.00     -0.03      0.01     -0.01      0.04
d_y2_d_x4     -0.04     -0.11      0.05      0.02     -0.05      0.07      0.02
d_y3_d_x4      0.01      0.03     -0.09      0.01      0.04     -0.05     -0.02
          d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
d_y1_d_x1      0.01      0.05      0.00     -0.04      0.01
d_y2_d_x1      0.00      0.05     -0.01     -0.11      0.03
d_y3_d_x1      0.03     -0.05      0.00      0.05     -0.09
d_y1_d_x2      0.00     -0.04     -0.03      0.02      0.01
d_y2_d_x2     -0.01      0.04      0.01     -0.05      0.04
d_y3_d_x2      0.03     -0.05     -0.01      0.07     -0.05
d_y1_d_x3     -0.02     -0.01      0.04      0.02     -0.02
d_y2_d_x3      0.07     -0.03     -0.01      0.05     -0.05
d_y3_d_x3     -0.03      0.13      0.01     -0.10      0.08
d_y1_d_x4     -0.01      0.01      0.06      0.00     -0.03
d_y2_d_x4      0.05     -0.10      0.00      0.32     -0.07
d_y3_d_x4     -0.05      0.08     -0.03     -0.07      0.22
> all.equal( attr( margEffCondObsV, "jacobian" ), 
+    attr( margEffCondObsM, "jacobian" )[ 1:3, , ] )
[1] TRUE
> round( attr( margEffCondObsM, "jacobian" ), 2 )
, , b_1_0

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.24      0.00      0.00     -0.16      0.02      0.05      0.12
5         0.28      0.01     -0.04     -0.18      0.01     -0.05      0.05
10        0.00      0.00      0.00      0.05      0.00     -0.02     -0.02
mean      0.17      0.00     -0.02     -0.10      0.01     -0.01      0.05
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1        -0.02     -0.05     -0.08      0.00      0.00
5         0.02      0.09     -0.03     -0.04      0.03
10        0.00      0.01      0.01      0.00      0.00
mean      0.00      0.02     -0.03     -0.01      0.01

, , b_1_1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.28     -0.01     -0.02      0.00      0.00      0.00      0.00
5         0.43     -0.06     -0.09     -0.18      0.01     -0.05      0.05
10        0.00      0.00      0.00      0.00      0.00      0.00      0.00
mean      0.24     -0.02     -0.04     -0.06      0.00     -0.02      0.02
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.00      0.00      0.00      0.00      0.00
5         0.02      0.09     -0.03     -0.04      0.03
10        0.00      0.00      0.00      0.00      0.00
mean      0.01      0.03     -0.01     -0.01      0.01

, , b_1_2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.24         0         0      0.04      0.00     -0.02      0.12
5         0.00         0         0      0.25     -0.06     -0.14      0.00
10        0.00         0         0      0.05      0.00     -0.02      0.00
mean      0.08         0         0      0.11     -0.02     -0.06      0.04
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1        -0.02     -0.05     -0.08         0         0
5         0.00      0.00      0.00         0         0
10        0.00      0.00      0.00         0         0
mean     -0.01     -0.02     -0.03         0         0

, , b_1_3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.25      0.00      0.00      0.17     -0.02     -0.06     -0.08
5        -0.17     -0.01      0.03      0.11      0.00      0.03      0.40
10       -0.01      0.00      0.00      0.06     -0.01     -0.03     -0.02
mean     -0.14      0.00      0.01      0.12     -0.01     -0.02      0.10
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.01      0.04      0.09      0.00      0.00
5        -0.08     -0.15      0.02      0.03     -0.02
10        0.00      0.01      0.02      0.00      0.00
mean     -0.02     -0.04      0.04      0.01     -0.01

, , b_1_4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.10      0.00      0.00     -0.07      0.01      0.02      0.05
5         0.23      0.01     -0.04     -0.15      0.01     -0.04      0.04
10        0.00      0.00      0.00     -0.02      0.00      0.01      0.01
mean      0.11      0.00     -0.01     -0.08      0.01      0.00      0.03
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1        -0.01     -0.02      0.00      0.00     -0.02
5         0.02      0.08      0.41     -0.10     -0.06
10        0.00      0.00      0.00      0.00      0.00
mean      0.00      0.02      0.14     -0.03     -0.03

, , b_2_0

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.01     -0.21     -0.01      0.02     -0.07     -0.02     -0.01
5        -0.05      0.06      0.02      0.02     -0.11      0.02      0.02
10        0.00      0.22      0.01      0.00      0.13      0.01      0.00
mean     -0.02      0.02      0.01      0.01     -0.02      0.00      0.00
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.24      0.03      0.00      0.32      0.03
5         0.05     -0.04      0.03      0.06     -0.04
10       -0.23     -0.01      0.00     -0.30     -0.01
mean      0.02     -0.01      0.01      0.03     -0.01

, , b_2_1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.01      0.12      0.00      0.00      0.00      0.00      0.00
5        -0.06      0.41      0.03      0.02     -0.11      0.02      0.02
10        0.00      0.35      0.01      0.00      0.00      0.00      0.00
mean     -0.02      0.29      0.02      0.01     -0.04      0.01      0.01
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.00      0.00      0.00      0.00      0.00
5         0.05     -0.04      0.03      0.06     -0.04
10        0.00      0.00      0.00      0.00      0.00
mean      0.02     -0.01      0.01      0.02     -0.01

, , b_2_2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.01     -0.21     -0.01      0.00      0.33      0.01     -0.01
5         0.00      0.00      0.00     -0.04      0.29      0.05      0.00
10        0.00      0.00      0.00      0.00      0.26      0.01      0.00
mean      0.00     -0.07      0.00     -0.02      0.29      0.03      0.00
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.24      0.03         0      0.32      0.03
5         0.00      0.00         0      0.00      0.00
10        0.00      0.00         0      0.00      0.00
mean      0.08      0.01         0      0.11      0.01

, , b_2_3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.01      0.22      0.01     -0.03      0.08      0.02      0.01
5         0.03     -0.04     -0.02     -0.01      0.07     -0.01     -0.07
10        0.00      0.28      0.01      0.00      0.17      0.01      0.00
mean      0.01      0.15      0.00     -0.01      0.11      0.01     -0.02
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.07     -0.01      0.00     -0.34     -0.03
5         0.37      0.06     -0.02     -0.04      0.02
10       -0.16     -0.01      0.00     -0.38     -0.02
mean      0.09      0.01     -0.01     -0.25     -0.01

, , b_2_4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.00     -0.09      0.00      0.01     -0.03     -0.01     -0.01
5        -0.04      0.05      0.02      0.02     -0.09      0.02      0.02
10        0.00     -0.08      0.00      0.00     -0.05      0.00      0.00
mean     -0.01     -0.04      0.00      0.01     -0.06      0.00      0.00
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.10      0.01      0.00      0.46      0.03
5         0.04     -0.03     -0.04      0.46      0.00
10        0.09      0.00      0.00      0.24      0.01
mean      0.08     -0.01     -0.01      0.39      0.01

, , b_3_0

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.02     -0.01     -0.16      0.05     -0.02     -0.13     -0.03
5        -0.07     -0.01      0.22      0.06     -0.01      0.06     -0.04
10        0.00      0.01      0.13     -0.01      0.01      0.15      0.00
mean     -0.03      0.00      0.06      0.03     -0.01      0.03     -0.02
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.02      0.24      0.01      0.02      0.29
5         0.00     -0.15     -0.03      0.03     -0.26
10       -0.01     -0.22      0.00     -0.01     -0.24
mean      0.01     -0.04     -0.01      0.01     -0.07

, , b_3_1

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.03      0.00      0.10      0.00      0.00      0.00      0.00
5        -0.12      0.05      0.37      0.06     -0.01      0.06     -0.04
10        0.00      0.01      0.27      0.00      0.00      0.00      0.00
mean     -0.05      0.02      0.25      0.02      0.00      0.02     -0.01
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1            0      0.00      0.00      0.00      0.00
5            0     -0.15     -0.03      0.03     -0.26
10           0      0.00      0.00      0.00      0.00
mean         0     -0.05     -0.01      0.01     -0.09

, , b_3_2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.02     -0.01     -0.16     -0.01      0.01      0.26     -0.03
5         0.00      0.00      0.00     -0.06      0.04      0.42      0.00
10        0.00      0.00      0.00     -0.01      0.01      0.30      0.00
mean     -0.01      0.00     -0.05     -0.03      0.02      0.33     -0.01
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.02      0.24      0.01      0.02      0.29
5         0.00      0.00      0.00      0.00      0.00
10        0.00      0.00      0.00      0.00      0.00
mean      0.01      0.08      0.00      0.01      0.10

, , b_3_3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.02      0.01      0.17     -0.05      0.02      0.13      0.02
5         0.05      0.00     -0.14     -0.04      0.01     -0.04     -0.10
10        0.00      0.01      0.16     -0.01      0.01      0.19      0.00
mean      0.02      0.01      0.07     -0.03      0.01      0.10     -0.03
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1        -0.01      0.00     -0.01     -0.03     -0.30
5         0.05      0.46      0.02     -0.02      0.16
10       -0.01     -0.13      0.00     -0.02     -0.30
mean      0.01      0.11      0.00     -0.02     -0.15

, , b_3_4

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.01      0.00     -0.07      0.02     -0.01     -0.05     -0.01
5        -0.06     -0.01      0.18      0.05     -0.01      0.05     -0.03
10        0.00      0.00     -0.05      0.00      0.00     -0.06      0.00
mean     -0.02     -0.01      0.02      0.02     -0.01     -0.02     -0.01
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.01      0.10      0.00      0.02      0.38
5         0.00     -0.12     -0.15      0.08      0.16
10        0.00      0.08      0.00      0.01      0.23
mean      0.01      0.02     -0.05      0.04      0.26

, , R_1_2

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.01     -0.02      0.00     -0.11      0.06      0.06      0.04
5        -0.26     -0.31      0.05      0.00      0.14      0.17      0.36
10        0.00      0.00      0.00     -0.01      0.01      0.01      0.00
mean     -0.08     -0.11      0.02     -0.04      0.07      0.08      0.14
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1        -0.03     -0.03      0.00      0.01     -0.01
5        -0.35     -0.20      0.37      0.29     -0.11
10        0.00      0.00      0.00      0.00      0.00
mean     -0.13     -0.08      0.12      0.10     -0.04

, , R_1_3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1        -0.03      0.00     -0.05      0.17     -0.01      0.12     -0.11
5        -0.14     -0.15     -0.01      0.22      0.00      0.33     -0.17
10        0.00      0.00      0.00      0.04      0.00      0.03     -0.01
mean     -0.06     -0.05     -0.02      0.14     -0.01      0.16     -0.10
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1         0.01     -0.08      0.02      0.00      0.03
5        -0.03     -0.40     -0.45      0.17      0.09
10        0.00     -0.01      0.00      0.00      0.00
mean     -0.01     -0.17     -0.14      0.06      0.04

, , R_2_3

     d_y1_d_x1 d_y2_d_x1 d_y3_d_x1 d_y1_d_x2 d_y2_d_x2 d_y3_d_x2 d_y1_d_x3
1         0.00      0.10     -0.11      0.01      0.14     -0.20     -0.01
5         0.11      0.19     -0.24     -0.05      0.20     -0.26     -0.06
10        0.00      0.11     -0.13      0.00      0.09     -0.08      0.00
mean      0.04      0.13     -0.16     -0.01      0.14     -0.18     -0.02
     d_y2_d_x3 d_y3_d_x3 d_y1_d_x4 d_y2_d_x4 d_y3_d_x4
1        -0.22      0.28      0.00     -0.26      0.34
5        -0.24      0.43     -0.06     -0.46      0.52
10       -0.08      0.08      0.00     -0.10      0.10
mean     -0.18      0.26     -0.02     -0.27      0.32

> round( drop( attr( margEffCondObsM, "jacobian" )[ 4, , ] ), 2 )
          b_1_0 b_1_1 b_1_2 b_1_3 b_1_4 b_2_0 b_2_1 b_2_2 b_2_3 b_2_4 b_3_0
d_y1_d_x1  0.17  0.24  0.08 -0.14  0.11 -0.02 -0.02  0.00  0.01 -0.01 -0.03
d_y2_d_x1  0.00 -0.02  0.00  0.00  0.00  0.02  0.29 -0.07  0.15 -0.04  0.00
d_y3_d_x1 -0.02 -0.04  0.00  0.01 -0.01  0.01  0.02  0.00  0.00  0.00  0.06
d_y1_d_x2 -0.10 -0.06  0.11  0.12 -0.08  0.01  0.01 -0.02 -0.01  0.01  0.03
d_y2_d_x2  0.01  0.00 -0.02 -0.01  0.01 -0.02 -0.04  0.29  0.11 -0.06 -0.01
d_y3_d_x2 -0.01 -0.02 -0.06 -0.02  0.00  0.00  0.01  0.03  0.01  0.00  0.03
d_y1_d_x3  0.05  0.02  0.04  0.10  0.03  0.00  0.01  0.00 -0.02  0.00 -0.02
d_y2_d_x3  0.00  0.01 -0.01 -0.02  0.00  0.02  0.02  0.08  0.09  0.08  0.01
d_y3_d_x3  0.02  0.03 -0.02 -0.04  0.02 -0.01 -0.01  0.01  0.01 -0.01 -0.04
d_y1_d_x4 -0.03 -0.01 -0.03  0.04  0.14  0.01  0.01  0.00 -0.01 -0.01 -0.01
d_y2_d_x4 -0.01 -0.01  0.00  0.01 -0.03  0.03  0.02  0.11 -0.25  0.39  0.01
d_y3_d_x4  0.01  0.01  0.00 -0.01 -0.03 -0.01 -0.01  0.01 -0.01  0.01 -0.07
          b_3_1 b_3_2 b_3_3 b_3_4 R_1_2 R_1_3 R_2_3
d_y1_d_x1 -0.05 -0.01  0.02 -0.02 -0.08 -0.06  0.04
d_y2_d_x1  0.02  0.00  0.01 -0.01 -0.11 -0.05  0.13
d_y3_d_x1  0.25 -0.05  0.07  0.02  0.02 -0.02 -0.16
d_y1_d_x2  0.02 -0.03 -0.03  0.02 -0.04  0.14 -0.01
d_y2_d_x2  0.00  0.02  0.01 -0.01  0.07 -0.01  0.14
d_y3_d_x2  0.02  0.33  0.10 -0.02  0.08  0.16 -0.18
d_y1_d_x3 -0.01 -0.01 -0.03 -0.01  0.14 -0.10 -0.02
d_y2_d_x3  0.00  0.01  0.01  0.01 -0.13 -0.01 -0.18
d_y3_d_x3 -0.05  0.08  0.11  0.02 -0.08 -0.17  0.26
d_y1_d_x4 -0.01  0.00  0.00 -0.05  0.12 -0.14 -0.02
d_y2_d_x4  0.01  0.01 -0.02  0.04  0.10  0.06 -0.27
d_y3_d_x4 -0.09  0.10 -0.15  0.26 -0.04  0.04  0.32
> all.equal( summary( margEffCondObsV )[ , ], summary( margEffCondObsM )[ 1:36, ],
+    check.attributes = FALSE )
[1] TRUE
> print( summary( margEffCondObsM ), digits = c( 3, 3, 2, 2, 2 ) )
                Estimate Std. error z value Pr(> z)
1: d_y1_d_x1       0.172      0.520    0.33    0.74
1: d_y2_d_x1       0.205      0.410    0.50    0.62
1: d_y3_d_x1      -0.127      0.330   -0.38    0.70
1: d_y1_d_x2      -0.096      0.330   -0.29    0.77
1: d_y2_d_x2       0.223      0.380    0.58    0.56
1: d_y3_d_x2      -0.175      0.410   -0.42    0.67
1: d_y1_d_x3       0.049      0.230    0.22    0.83
1: d_y2_d_x3      -0.385      0.430   -0.89    0.37
1: d_y3_d_x3       0.244      0.470    0.52    0.60
1: d_y1_d_x4      -0.036      0.150   -0.24    0.81
1: d_y2_d_x4      -0.504      0.780   -0.65    0.52
1: d_y3_d_x4       0.302      0.720    0.42    0.68
2: d_y1_d_x1       0.396      0.690    0.57    0.57
2: d_y2_d_x1       0.265      0.580    0.46    0.65
2: d_y3_d_x1      -0.224      0.550   -0.40    0.69
2: d_y1_d_x2      -0.323      0.480   -0.67    0.50
2: d_y2_d_x2       0.252      0.430    0.58    0.56
2: d_y3_d_x2      -0.134      0.660   -0.20    0.84
2: d_y1_d_x3       0.539      0.590    0.91    0.36
2: d_y2_d_x3      -0.524      0.580   -0.90    0.37
2: d_y3_d_x3       0.232      0.840    0.28    0.78
2: d_y1_d_x4      -0.395      0.730   -0.54    0.59
2: d_y2_d_x4      -0.539      0.750   -0.72    0.47
2: d_y3_d_x4       0.456      0.690    0.66    0.51
3: d_y1_d_x1       0.001      0.010    0.16    0.87
3: d_y2_d_x1       0.232      0.510    0.45    0.65
3: d_y3_d_x1      -0.116      0.370   -0.31    0.75
3: d_y1_d_x2      -0.019      0.100   -0.18    0.86
3: d_y2_d_x2       0.111      0.350    0.32    0.75
3: d_y3_d_x2      -0.138      0.400   -0.34    0.73
3: d_y1_d_x3       0.006      0.030    0.19    0.85
3: d_y2_d_x3      -0.149      0.300   -0.50    0.62
3: d_y3_d_x3       0.148      0.280    0.53    0.59
3: d_y1_d_x4      -0.005      0.020   -0.20    0.84
3: d_y2_d_x4      -0.199      0.550   -0.36    0.72
3: d_y3_d_x4       0.166      0.460    0.36    0.72
mean: d_y1_d_x1    0.190      0.380    0.50    0.61
mean: d_y2_d_x1    0.234      0.390    0.61    0.54
mean: d_y3_d_x1   -0.156      0.320   -0.49    0.62
mean: d_y1_d_x2   -0.146      0.270   -0.54    0.59
mean: d_y2_d_x2    0.195      0.360    0.54    0.59
mean: d_y3_d_x2   -0.149      0.430   -0.34    0.73
mean: d_y1_d_x3    0.198      0.210    0.93    0.35
mean: d_y2_d_x3   -0.353      0.270   -1.31    0.19
mean: d_y3_d_x3    0.208      0.360    0.58    0.56
mean: d_y1_d_x4   -0.145      0.250   -0.59    0.55
mean: d_y2_d_x4   -0.414      0.560   -0.73    0.46
mean: d_y3_d_x4    0.308      0.460    0.66    0.51
> 
> # for testing state of random number generator
> rnorm( 4 )
[1]  0.1870  0.3303 -1.2091  1.9202
> 
> 
> proc.time()
   user  system elapsed 
  81.64    0.26   81.96 
